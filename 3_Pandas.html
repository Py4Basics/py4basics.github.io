
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pandas：データ分析 &#8212; 経済学のためのPython入門</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/my_style.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://py4basics.github.io/3_Pandas.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Matplotlib：図示" href="4_matplotlib.html" />
    <link rel="prev" title="NumPy：高速化" href="2_NumPy.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-165998213-3', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">経済学のためのPython入門</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Python入門
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1a_Basics_I.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Python
    </span>
   </code>
   ：基礎（その１）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1b_Basics_II.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Python
    </span>
   </code>
   ：基礎（その２）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2_NumPy.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     NumPy
    </span>
   </code>
   ：高速化
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   <code class="docutils literal notranslate">
    <span class="pre">
     Pandas
    </span>
   </code>
   ：データ分析
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4_matplotlib.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Matplotlib
    </span>
   </code>
   ：図示
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5_pandas_plot.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Pandas
    </span>
   </code>
   ：図示
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6_SciPy_stats.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     SciPy.stats
    </span>
   </code>
   ：確率分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7_SciPy_optimize.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     SciPy.optimize
    </span>
   </code>
   ：解の求め方と最適化問題
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  参考
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="0_Preparations.html">
   ツールのインストールと説明
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="things_to_note.html">
   Tipsと注意点
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Grade.html">
   学業成績の分析
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Gapminder.html">
   Gapminder
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  経済学
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://py4macro.github.io">
   Pythonで学ぶマクロ経済学（中級＋レベル）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://py4etrics.github.io">
   Pythonで学ぶ入門計量経済学
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <a  href="https://github.com/Py4Basics/py4basics.github.io">&#128200;&#127891;&#128202; <!-- Default Statcounter code for Py4Basics https://py4basics.github.io --> <script type="text/javascript"> var sc_project=12615270; var sc_invisible=1; var sc_security="2a7796f0"; </script> <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script> <noscript><div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12615270/0/2a7796f0/1/" alt="Web Analytics" referrerPolicy="no-referrer-when-downgrade"></a></div></noscript> <!-- End of Statcounter Code --></a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/3_Pandas.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/Py4Basics/py4basics.github.io/source?urlpath=tree/3_Pandas.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/Py4Basics/py4basics.github.io/blob/source/3_Pandas.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   説明
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sec-3-data">
   データの読み込みとデータのチェック
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframe">
   <code class="docutils literal notranslate">
    <span class="pre">
     DataFrame
    </span>
   </code>
   の構成要素
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   要素の抽出
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loc">
     <code class="docutils literal notranslate">
      <span class="pre">
       .loc[,]
      </span>
     </code>
     （ラベル使用）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iloc">
     <code class="docutils literal notranslate">
      <span class="pre">
       .iloc[]
      </span>
     </code>
     （インデックス使用）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     <code class="docutils literal notranslate">
      <span class="pre">
       []
      </span>
     </code>
     で列の選択（ラベル使用）
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   ある条件の下で行の抽出
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     １つの条件の場合
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gdp100">
       例１：GDPが100未満の行の抽出
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ida">
       例２：
       <code class="docutils literal notranslate">
        <span class="pre">
         id
        </span>
       </code>
       が
       <code class="docutils literal notranslate">
        <span class="pre">
         a
        </span>
       </code>
       の行を抽出
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     複数条件の場合
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       例３
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       例４
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id10">
       例５
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#query">
     <code class="docutils literal notranslate">
      <span class="pre">
       query()
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       例１の場合：
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id12">
       例２の場合
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id13">
       例３の場合
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       例４の場合
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id15">
       例５の場合
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id16">
   列と行の追加と削除
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     列の追加
     <code class="docutils literal notranslate">
      <span class="pre">
       [
      </span>
      <span class="pre">
       ]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     列の追加
     <code class="docutils literal notranslate">
      <span class="pre">
       .loc[,]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id19">
     列の削除
     <code class="docutils literal notranslate">
      <span class="pre">
       [
      </span>
      <span class="pre">
       ]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#drop">
     列の削除
     <code class="docutils literal notranslate">
      <span class="pre">
       drop()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id20">
     行の追加
     <code class="docutils literal notranslate">
      <span class="pre">
       .loc[,]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id21">
     行の削除
     <code class="docutils literal notranslate">
      <span class="pre">
       drop()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id22">
   欠損値の扱い
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id23">
     欠損値の確認
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id24">
     欠損値がある行の削除
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id25">
   並び替え
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id26">
   行インデックスと列ラベル
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id27">
     インデックスを振り直す
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id28">
     列のラベルの変更
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id29">
   よく使うのメソッド
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id30">
     統計関連のメソッド
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id31">
     その他
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#series">
   <code class="docutils literal notranslate">
    <span class="pre">
     Series
    </span>
   </code>
   について
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id32">
     構成要素
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id33">
     要素の抽出
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id34">
     統計学関連メソッド
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id35">
   グループ計算
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id36">
     ステップ１：グループ化する列を指定
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id37">
     ステップ２：グループ計算したい列を指定
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id38">
     ステップ３：計算方法の指定
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id39">
     次のステップ
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id40">
       １行で書く
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id41">
       複数選択
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Pandas：データ分析</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   説明
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sec-3-data">
   データの読み込みとデータのチェック
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframe">
   <code class="docutils literal notranslate">
    <span class="pre">
     DataFrame
    </span>
   </code>
   の構成要素
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   要素の抽出
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loc">
     <code class="docutils literal notranslate">
      <span class="pre">
       .loc[,]
      </span>
     </code>
     （ラベル使用）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iloc">
     <code class="docutils literal notranslate">
      <span class="pre">
       .iloc[]
      </span>
     </code>
     （インデックス使用）
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     <code class="docutils literal notranslate">
      <span class="pre">
       []
      </span>
     </code>
     で列の選択（ラベル使用）
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   ある条件の下で行の抽出
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     １つの条件の場合
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#gdp100">
       例１：GDPが100未満の行の抽出
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ida">
       例２：
       <code class="docutils literal notranslate">
        <span class="pre">
         id
        </span>
       </code>
       が
       <code class="docutils literal notranslate">
        <span class="pre">
         a
        </span>
       </code>
       の行を抽出
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     複数条件の場合
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       例３
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       例４
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id10">
       例５
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#query">
     <code class="docutils literal notranslate">
      <span class="pre">
       query()
      </span>
     </code>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       例１の場合：
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id12">
       例２の場合
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id13">
       例３の場合
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       例４の場合
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id15">
       例５の場合
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id16">
   列と行の追加と削除
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     列の追加
     <code class="docutils literal notranslate">
      <span class="pre">
       [
      </span>
      <span class="pre">
       ]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     列の追加
     <code class="docutils literal notranslate">
      <span class="pre">
       .loc[,]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id19">
     列の削除
     <code class="docutils literal notranslate">
      <span class="pre">
       [
      </span>
      <span class="pre">
       ]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#drop">
     列の削除
     <code class="docutils literal notranslate">
      <span class="pre">
       drop()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id20">
     行の追加
     <code class="docutils literal notranslate">
      <span class="pre">
       .loc[,]
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id21">
     行の削除
     <code class="docutils literal notranslate">
      <span class="pre">
       drop()
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id22">
   欠損値の扱い
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id23">
     欠損値の確認
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id24">
     欠損値がある行の削除
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id25">
   並び替え
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id26">
   行インデックスと列ラベル
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id27">
     インデックスを振り直す
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id28">
     列のラベルの変更
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id29">
   よく使うのメソッド
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id30">
     統計関連のメソッド
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id31">
     その他
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#series">
   <code class="docutils literal notranslate">
    <span class="pre">
     Series
    </span>
   </code>
   について
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id32">
     構成要素
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id33">
     要素の抽出
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id34">
     統計学関連メソッド
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id35">
   グループ計算
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id36">
     ステップ１：グループ化する列を指定
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id37">
     ステップ２：グループ計算したい列を指定
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id38">
     ステップ３：計算方法の指定
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id39">
     次のステップ
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id40">
       １行で書く
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id41">
       複数選択
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="pandas">
<span id="chap-pandas"></span><h1><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>：データ分析<a class="headerlink" href="#pandas" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">see</span> <span class="kn">import</span> <span class="n">see</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>説明<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>はデータを扱う上で欠かせないパッケージであり，エクセルをイメージすれば良いだろう。<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>にはスプレッド・シートに対応する<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>（データ・フレーム）と<code class="docutils literal notranslate"><span class="pre">Series</span></code>（シリーズ）呼ばれるオブジェクトがあり，それらを駆使してデータ分析をおこなう。</p>
<p>データ・フレームは下の図のようになっている。<code class="docutils literal notranslate"><span class="pre">X</span></code>，<code class="docutils literal notranslate"><span class="pre">Y</span></code>，<code class="docutils literal notranslate"><span class="pre">Z</span></code>は「列ラベル」（アルファベットや記号など）であり、一番左の<code class="docutils literal notranslate"><span class="pre">1</span></code>，<code class="docutils literal notranslate"><span class="pre">2</span></code>，<code class="docutils literal notranslate"><span class="pre">3</span></code>は「行インデックス」（数字）である（「行ラベル」（アルファベットや記号など）を設定することも可能）。その他の数字がデータとなっている。</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div name="html-admonition">
Do you want to read in a differnt language? Open the 
<input type="button" onclick="location.href='https://translate.google.com/translate?hl=&sl=ja&tl=en&u='+window.location;" value="Google translated version" style="color:#ffffff;background-color:#008080;" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#008080'"/>
in English or the language of your choice.
</div>
</div>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>X</p></th>
<th class="head"><p>Y</p></th>
<th class="head"><p>Z</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>10</p></td>
<td><p>5.0</p></td>
<td><p>3.0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>20</p></td>
<td><p>30.0</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>30</p></td>
<td><p>15.0</p></td>
<td><p>5.0</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">X</span></code>のデータはその列にある数字<code class="docutils literal notranslate"><span class="pre">10</span></code>，<code class="docutils literal notranslate"><span class="pre">20</span></code>，<code class="docutils literal notranslate"><span class="pre">30</span></code>であり，<code class="docutils literal notranslate"><span class="pre">Y</span></code>と<code class="docutils literal notranslate"><span class="pre">Z</span></code>も同様に同じ列にあるデータから構成される。<code class="docutils literal notranslate"><span class="pre">Series</span></code>は１つの列からなるスプレッド・シートと考えれば良いだろう。</p>
<p>この特徴により複雑なデータでも扱いが簡単になる。例えば，<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>を使うと目的のデータがどこにあるのかは，何番目の行で何番目の列なのかを把握する必要があるが，<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>では行・列にラベルを使うことにより（例えば，行「1980年」の列「GDP」のようにデータを特定することが可能となる），データの操作が非常に簡単になる。また，<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>は<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>に基づいているため，ベクトル演算の機能が使える。</p>
<p>ここで説明できない他の使い方については<a class="reference external" href="https://github.com/ysdyt/pandas_tutorial">このサイト</a>と<a class="reference external" href="https://note.nkmk.me/python-pandas-post-summary/">このサイト</a>が参考になる。</p>
<p>通常<code class="docutils literal notranslate"><span class="pre">pd</span></code>という名前で読み込む。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
<div class="section" id="sec-3-data">
<span id="id2"></span><h2>データの読み込みとデータのチェック<a class="headerlink" href="#sec-3-data" title="Permalink to this headline">¶</a></h2>
<p>様々なデータを読み込むことが可能だが，ここでは<code class="docutils literal notranslate"><span class="pre">read_csv()</span></code>関数を使ってインターネット上の<code class="docutils literal notranslate"><span class="pre">.csv</span></code>ファイルを読み込む。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># url の設定</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/Haruyama-KobeU/Py4Basics/master/data/data1.csv&#39;</span>

<span class="c1"># 読み込み</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>全体を表示させる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000</td>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2001</td>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2002</td>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2003</td>
      <td>100</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11</td>
      <td>b</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2004</td>
      <td>110</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12</td>
      <td>a</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2005</td>
      <td>115</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
      <td>b</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2006</td>
      <td>113</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15</td>
      <td>a</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2007</td>
      <td>118</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17</td>
      <td>b</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2008</td>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2009</td>
      <td>200</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20</td>
      <td>b</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2010</td>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>行はインデックス（番号）になっており，そのまま使っても全く問題ない。ここでは列<code class="docutils literal notranslate"><span class="pre">year</span></code>を行ラベルに設定して<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>の使い方について説明することにする。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set_index()</span></code>：選択された列を行ラベルにするメソッド</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.set_index('year')</span></code>は直接<code class="docutils literal notranslate"><span class="pre">df</span></code>に影響を与えない。単に，書き換えるとどうなるかを表示している。ここでは<code class="docutils literal notranslate"><span class="pre">df</span></code>に再度割り当てることにより<code class="docutils literal notranslate"><span class="pre">df</span></code>自体を上書きしている。</p></li>
<li><p>出力にある<code class="docutils literal notranslate"><span class="pre">NaN</span></code>（Not a Number）は欠損値を示す。</p></li>
<li><p>行ラベルに<code class="docutils literal notranslate"><span class="pre">year</span></code>という列名が残るが，それを消すにはメソッド<code class="docutils literal notranslate"><span class="pre">.rename_axis('')</span></code>を使う。ここで<code class="docutils literal notranslate"><span class="pre">''</span></code>は空の文字列である。<code class="docutils literal notranslate"><span class="pre">.rename_axis(None)</span></code>でも同じ結果となる。</p></li>
</ul>
</div>
<p>行数が大きい場合（例えば，10000），全てを表示してもあまり意味がない。そこでよく使うメソッドに最初や最後の数行だけを表示すものがある。</p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>の最初の５行を表示させる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>引数に2を指定すると最初の3行のみ表示される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>最後の5行を表示させる。引数に整数を入れて表示行数を指定することも可能。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006</th>
      <td>113</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>の情報を確認する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 11 entries, 2000 to 2010
Data columns (total 5 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   gdp     11 non-null     int64  
 1   inv     10 non-null     float64
 2   con     9 non-null      float64
 3   pop     11 non-null     int64  
 4   id      11 non-null     object 
dtypes: float64(2), int64(2), object(1)
memory usage: 528.0+ bytes
</pre></div>
</div>
</div>
</div>
<p><strong>説明</strong>：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'pandas.core.frame.DataFrame'&gt;</span></code></p>
<ul>
<li><p>クラス名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type(1)</span></code>とすると<code class="docutils literal notranslate"><span class="pre">int</span></code>というデータ型が表示するが，これはクラス名でもある。<code class="docutils literal notranslate"><span class="pre">print(type(1))</span></code>とすると<code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'int'&gt;</span></code>と表示される。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Int64Index:</span> <span class="pre">11</span> <span class="pre">entries,</span> <span class="pre">2000</span> <span class="pre">to</span> <span class="pre">2010</span></code></p>
<ul>
<li><p>行のインデックスの情報</p></li>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">Int64</span></code>(整数）（データ型には<code class="docutils literal notranslate"><span class="pre">64</span></code>や<code class="docutils literal notranslate"><span class="pre">32</span></code>という数字がついている場合がある。それらは数字をコンピュータのメモリに記憶させる際，何ビット必要かを示している。より重要なのは<code class="docutils literal notranslate"><span class="pre">Int</span></code>（整数）の部分である。）</p></li>
<li><p>11個のデータで2000から2010</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">columns</span> <span class="pre">(total</span> <span class="pre">5</span> <span class="pre">columns):</span></code></p>
<ul>
<li><p>データ列の数（5つ）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span>&#160; <span class="pre">11</span> <span class="pre">non-null</span> <span class="pre">int64</span></code></p>
<ul>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">int64</span></code></p></li>
<li><p>11のデータがあり，欠損値なし（<code class="docutils literal notranslate"><span class="pre">non-null</span></code>とは欠損値ではないデータ）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">inv</span>&#160; <span class="pre">10</span> <span class="pre">non-null</span> <span class="pre">float64</span></code></p>
<ul>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">float64</span></code></p></li>
<li><p>10のデータがあり，欠損値数は1（＝11-10）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span>&#160; <span class="pre">9</span> <span class="pre">non-null</span> <span class="pre">float64</span></code></p>
<ul>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">float64</span></code></p></li>
<li><p>9のデータがあり，欠損値数は2（＝11-9）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pop</span>&#160; <span class="pre">11</span> <span class="pre">non-null</span> <span class="pre">int64</span></code></p>
<ul>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">int64</span></code></p></li>
<li><p>11のデータがあり，欠損値数なし</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">id</span>&#160;&#160; <span class="pre">11</span> <span class="pre">non-null</span> <span class="pre">object</span></code></p>
<ul>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">object</span></code>（文字列などの場合）</p></li>
<li><p>11のデータがあり，欠損値数なし</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dtypes:</span> <span class="pre">float64(2),</span> <span class="pre">int64(2),</span> <span class="pre">object(1)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の列にどのようなのデータ型かを示す</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">float64</span></code>と<code class="docutils literal notranslate"><span class="pre">int64</span></code>が2列つずつ，文字列は１列</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">usage:</span> <span class="pre">528.0+</span> <span class="pre">bytes</span></code></p>
<ul>
<li><p>メモリー使用量は約528.0バイト</p></li>
</ul>
</li>
</ul>
<p>データを読み込んだら必ず<code class="docutils literal notranslate"><span class="pre">info()</span></code>を使って欠損値の数や列のデータ型を確認すること。</p>
<p>また，データの統計的な特徴は次のメソッドでチェックできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>11.000000</td>
      <td>10.000000</td>
      <td>9.000000</td>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>124.818182</td>
      <td>41.500000</td>
      <td>67.777778</td>
      <td>14.090909</td>
    </tr>
    <tr>
      <th>std</th>
      <td>40.715644</td>
      <td>16.473885</td>
      <td>6.666667</td>
      <td>4.482288</td>
    </tr>
    <tr>
      <th>min</th>
      <td>93.000000</td>
      <td>20.000000</td>
      <td>59.000000</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>100.000000</td>
      <td>26.250000</td>
      <td>63.000000</td>
      <td>10.500000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>113.000000</td>
      <td>44.500000</td>
      <td>70.000000</td>
      <td>14.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>118.500000</td>
      <td>54.500000</td>
      <td>71.000000</td>
      <td>17.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>210.000000</td>
      <td>62.000000</td>
      <td>80.000000</td>
      <td>21.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">count</span></code>：観測値の数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean</span></code>：平均</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std</span></code>：標準偏差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code>：最小値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code>：最大値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">25%</span></code>：第１四分位数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">50%</span></code>：第２四分位数（中央値）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">75%</span></code>：第３四分位数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code>：最大値</p></li>
</ul>
<p>次のデータ属性を使って<code class="docutils literal notranslate"><span class="pre">df</span></code>の行と列の長さを確認することができる。返値はタプルで，<code class="docutils literal notranslate"><span class="pre">(行の数，列の数)</span></code>と解釈する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11, 5)
</pre></div>
</div>
</div>
</div>
<p>返値はタプルなので，行数は以下で取得できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11
</pre></div>
</div>
</div>
</div>
<p>以下でも行数を示すことができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dataframe">
<h2><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の構成要素<a class="headerlink" href="#dataframe" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には様々な属性があるが，ここでは以下の３点について説明する。</p>
<ul class="simple">
<li><p>データ：<code class="docutils literal notranslate"><span class="pre">df.to_numpy()</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">df.values</span></code>で抽出できる。</p></li>
<li><p>列ラベル：<code class="docutils literal notranslate"><span class="pre">df.columns</span></code>で抽出できる。</p></li>
<li><p>行ラベル：<code class="docutils literal notranslate"><span class="pre">df.index</span></code>で抽出できる。</p></li>
</ul>
<p>まずデータ自体を抽出する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[100, 20.0, 80.0, 8, &#39;a&#39;],
       [95, 25.0, 70.0, 9, &#39;b&#39;],
       [93, 21.0, 72.0, 10, &#39;a&#39;],
       [100, 30.0, 70.0, 11, &#39;b&#39;],
       [110, 39.0, 71.0, 12, &#39;a&#39;],
       [115, 55.0, 60.0, 14, &#39;b&#39;],
       [113, 50.0, 63.0, 15, &#39;a&#39;],
       [118, 53.0, 65.0, 17, &#39;b&#39;],
       [119, 60.0, 59.0, 18, &#39;a&#39;],
       [200, 62.0, nan, 20, &#39;b&#39;],
       [210, nan, nan, 21, &#39;a&#39;]], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy.ndarray
</pre></div>
</div>
</div>
</div>
<p>これで分かることは，メインのデータの部分は<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>の<code class="docutils literal notranslate"><span class="pre">ndarray</span></code>（<code class="docutils literal notranslate"><span class="pre">n</span></code>次元<code class="docutils literal notranslate"><span class="pre">array</span></code>）であることが分かる。即ち，<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>は<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>に基づいて構築されており，データ値の計算などは<code class="docutils literal notranslate"><span class="pre">array</span></code>が裏で動いているということである。また行と列のラベルを追加し，より直感的に使えるように拡張しているのである。</p>
<p>次に列ラベルを取り出してみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;gdp&#39;, &#39;inv&#39;, &#39;con&#39;, &#39;pop&#39;, &#39;id&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dtype='object'</span></code>から列ラベルに使われているデータ型（<code class="docutils literal notranslate"><span class="pre">dtype</span></code>）はオブジェクト型（<code class="docutils literal notranslate"><span class="pre">object</span></code>）だとわかる。</p>
<ul class="simple">
<li><p>オブジェクト型とは文字型を含む「その他」のデータ型と理解すれば良いだろう。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dtype='object'</span></code>と<code class="docutils literal notranslate"><span class="pre">dtype=object</span></code>は同じ意味。</p></li>
</ul>
<p>列ラベル自体のクラスは次のコードで調べることができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.base.Index
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dir()</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">see()</span></code>で調べると多くのメソッドや属性が確認できるが，その中に<code class="docutils literal notranslate"><span class="pre">.tolist()</span></code>が含まれており，これを使うことにより列ラベルをリストに変換することができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;gdp&#39;, &#39;inv&#39;, &#39;con&#39;, &#39;pop&#39;, &#39;id&#39;]
</pre></div>
</div>
</div>
</div>
<p>行ラベルについても同じことができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Int64Index([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010], dtype=&#39;int64&#39;, name=&#39;year&#39;)
</pre></div>
</div>
</div>
</div>
<p>行ラベルのデータ型<code class="docutils literal notranslate"><span class="pre">dtype</span></code>は整数である<code class="docutils literal notranslate"><span class="pre">int64</span></code>。列<code class="docutils literal notranslate"><span class="pre">year</span></code>を行ラベルに指定したため，<code class="docutils literal notranslate"><span class="pre">name='year'</span></code>はその列ラベルを表示している。行ラベルのデータ型（クラス）は</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.numeric.Int64Index
</pre></div>
</div>
</div>
</div>
<p>であり，ラベルをリストとして抽出することもできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>要素の抽出<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">NumPy</span></code>の<code class="docutils literal notranslate"><span class="pre">array</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">[,]</span></code>を使い要素を抽出した。<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>の場合，様々な抽出方法があるが，覚えやすく少しでも間違いの可能性を減らすために，そして可読性向上のために<code class="docutils literal notranslate"><span class="pre">array</span></code>に対応する以下の２つの方法を使うことにする。</p>
<ul class="simple">
<li><p>ラベルを使う方法：<code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code></p></li>
<li><p>インデックスを使う方法：<code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>（これは<code class="docutils literal notranslate"><span class="pre">array</span></code>の<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>と同じと考えて良い）</p></li>
</ul>
<p>１つ目の<code class="docutils literal notranslate"><span class="pre">loc</span></code>はラベルのlocationと覚えよう。２つ目はの<code class="docutils literal notranslate"><span class="pre">iloc</span></code>の<code class="docutils literal notranslate"><span class="pre">i</span></code>はインデックス（index）の<code class="docutils literal notranslate"><span class="pre">i</span></code>であり，index locationという意味である。使い方は<code class="docutils literal notranslate"><span class="pre">array</span></code>の場合と基本的に同じである。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code>の左は行，右は列を表す。</p></li>
<li><p>行または列を連続して選択する（slicing）場合は<code class="docutils literal notranslate"><span class="pre">:</span></code>を使う。（<code class="docutils literal notranslate"><span class="pre">start:end</span></code>）</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code>の左右を省略する場合は，「全て」という意味になる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code>の左を省略すると「最初から」という意味になる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code>の右を省略すると「最後まで」という意味になる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>を含む。（要注意！）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>は含まず，その１つ前のインデックスまでが含まれる。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code>の右に書く<code class="docutils literal notranslate"><span class="pre">:</span></code>は省略可能であるが省略しないことを推奨する。</p></li>
</ul>
<p>「特例」として<code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>と<code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>以外に</p>
<ul class="simple">
<li><p>ラベルと<code class="docutils literal notranslate"><span class="pre">[]</span></code>だけを使い<strong>列</strong>を選択する方法</p></li>
</ul>
<p>も説明する。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>を含む。（要注意！）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>は含まず，その１つ前のインデックスまでが含まれる。</p></li>
</ul>
</div>
<div class="section" id="loc">
<h3><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>（ラベル使用）<a class="headerlink" href="#loc" title="Permalink to this headline">¶</a></h3>
<p><strong>１つの行を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2005</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp     115
inv    55.0
con    60.0
pop      14
id        b
Name: 2005, dtype: object
</pre></div>
</div>
</div>
</div>
<p><strong>１つの行を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">2005</span><span class="p">],:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数行を抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2010</span><span class="p">],:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数行を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2005</span><span class="p">:</span><span class="mi">2008</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    100
2001     95
2002     93
2003    100
2004    110
2005    115
2006    113
2007    118
2008    119
2009    200
2010    210
Name: gdp, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>複数列を抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>21</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数列を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;inv&#39;</span><span class="p">:</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>30.0</td>
      <td>70.0</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>39.0</td>
      <td>71.0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>50.0</td>
      <td>63.0</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>53.0</td>
      <td>65.0</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>62.0</td>
      <td>NaN</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="iloc">
<span id="sec-3-iloc"></span><h3><code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>（インデックス使用）<a class="headerlink" href="#iloc" title="Permalink to this headline">¶</a></h3>
<p><strong>１つの行を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp      95
inv    25.0
con    70.0
pop       9
id        b
Name: 2001, dtype: object
</pre></div>
</div>
</div>
</div>
<p><strong>複数行を抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">],:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数行を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    20.0
2001    25.0
2002    21.0
2003    30.0
2004    39.0
2005    55.0
2006    50.0
2007    53.0
2008    60.0
2009    62.0
2010     NaN
Name: inv, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>inv</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>20.0</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>25.0</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>21.0</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>30.0</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>39.0</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>55.0</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>50.0</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>53.0</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>60.0</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>62.0</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数列を選択</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>inv</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>20.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>25.0</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>21.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>30.0</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>39.0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>55.0</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>50.0</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>53.0</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>60.0</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>62.0</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>NaN</td>
      <td>21</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数列を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>inv</th>
      <th>con</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>20.0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>25.0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>21.0</td>
      <td>72.0</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>30.0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>39.0</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>55.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>50.0</td>
      <td>63.0</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>53.0</td>
      <td>65.0</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>60.0</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>62.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id4">
<h3><code class="docutils literal notranslate"><span class="pre">[]</span></code>で列の選択（ラベル使用）<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    100
2001     95
2002     93
2003    100
2004    110
2005    115
2006    113
2007    118
2008    119
2009    200
2010    210
Name: gdp, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>115</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数列を選択</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>18</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>21</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>ある条件の下で行の抽出<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id6">
<h3>１つの条件の場合<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="section" id="gdp100">
<h4>例１：GDPが100未満の行の抽出<a class="headerlink" href="#gdp100" title="Permalink to this headline">¶</a></h4>
<p>まず条件を作る。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    False
2001     True
2002     True
2003    False
2004    False
2005    False
2006    False
2007    False
2008    False
2009    False
2010    False
Name: gdp, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>この条件では，GDPが100未満の行は<code class="docutils literal notranslate"><span class="pre">True</span></code>，以上の行は<code class="docutils literal notranslate"><span class="pre">False</span></code>となる。この条件を<code class="docutils literal notranslate"><span class="pre">cond</span></code>というの変数に割り当てる。<code class="docutils literal notranslate"><span class="pre">()</span></code>を省いても良いが，ある方が分かりやすいだろう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cond</span></code>を<code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>の引数とすることにより，<code class="docutils literal notranslate"><span class="pre">True</span></code>の行だけを抽出できる。（注意：<code class="docutils literal notranslate"><span class="pre">cond</span></code>を使って<strong>行</strong>を抽出しようとしているので<code class="docutils literal notranslate"><span class="pre">,</span></code>の左側に書く。）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>この条件の下で<span class="math notranslate nohighlight">\(inv\)</span>だけを抽出したい場合</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[cond,'inv']</span></code></p></li>
</ul>
<p>とする。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>以下のように抽出を連続ですることも可能だが，避けるように！</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[cond,:]['inv']</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[cond,:].loc[:,'inv']</span></code></p></li>
</ul>
</div>
</div>
<div class="section" id="ida">
<h4>例２：<code class="docutils literal notranslate"><span class="pre">id</span></code>が<code class="docutils literal notranslate"><span class="pre">a</span></code>の行を抽出<a class="headerlink" href="#ida" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>複数条件の場合<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id8">
<h4>例３<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>以下の条件の<strong>両方</strong>が満たされる場合：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>が100以上</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inv</span></code>が30以下</p></li>
</ul>
<p>それぞれの条件を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;inv&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>２つの条件が同時に満たされる条件を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cond</span></code>を引数に使い行を抽出する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id9">
<h4>例４<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>以下の条件の<strong>どちらか</strong>が満たされる場合：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>は200以上</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span></code>は60以下</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">cond1</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id10">
<h4>例５<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>以下の条件の<strong>どちらか</strong>が満たされ</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>は200以上</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span></code>は60以下</p></li>
</ul>
<p>かつ以下の条件も<strong>同時に</strong>満たされる場合：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code>が<code class="docutils literal notranslate"><span class="pre">a</span></code>と等しい</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">cond3</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">cond</span> <span class="o">=</span> <span class="p">((</span><span class="n">cond1</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">cond3</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="query">
<h3><code class="docutils literal notranslate"><span class="pre">query()</span></code><a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">query()</span></code>というメソッドでは文字列を使い行の抽出コードを書くことができる。これにより直感的なコード書くことが可能である。</p>
<div class="section" id="id11">
<h4>例１の場合：<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;gdp &lt; 100&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id12">
<h4>例２の場合<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;id == &quot;a&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id13">
<h4>例３の場合<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(gdp &gt;= 100) &amp; (inv &lt;= 30)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id14">
<h4>例４の場合<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(gdp &gt;= 200) | (con &lt;= 60)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2005</th>
      <td>115</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id15">
<h4>例５の場合<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(gdp &gt;= 200 | con &lt;= 60) &amp; (id == &quot;a&quot;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2008</th>
      <td>119</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>にない変数で条件を設定する場合<code class="docutils literal notranslate"><span class="pre">&#64;</span></code>が必要になる。例えば，変数<code class="docutils literal notranslate"><span class="pre">z</span></code>という変数があるとしよう。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>変数<code class="docutils literal notranslate"><span class="pre">z</span></code>の値に基づいて行の抽出をする場合は次のようにする。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;gdp &lt; @z&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="pasted-inline"><span class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></span></span></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>数字で始まる列ラベルに<code class="docutils literal notranslate"><span class="pre">.query()</span></code>を使うとエラーが発生するため，列ラベルを変更する必要がある。列ラベルを変更できない場合は異なる方法を使うように。</p>
</div>
</div>
</div>
</div>
<div class="section" id="id16">
<h2>列と行の追加と削除<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id17">
<h3>列の追加 <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">[]</span></code>に列ラベルを使って列を抽出することができるが，<code class="docutils literal notranslate"><span class="pre">[]</span></code>は列の追加にも使えるので，ここではその使い方を説明する。まず，全ての行が<code class="docutils literal notranslate"><span class="pre">1.0</span></code>となる列を作成するとしよう。その場合，以下のようにする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
      <th>Intercept</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>次の例では既存の列から新たな列を作成する。まず１人当たりGDPの計算を計算し，それを変数<code class="docutils literal notranslate"><span class="pre">gdp_pc</span></code>に割り当てる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdp_pc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
<span class="n">gdp_pc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    12.500000
2001    10.555556
2002     9.300000
2003     9.090909
2004     9.166667
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>これは<code class="docutils literal notranslate"><span class="pre">Series</span></code>であり，<code class="docutils literal notranslate"><span class="pre">GDPpc</span></code>として<code class="docutils literal notranslate"><span class="pre">df</span></code>に追加する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp_pc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdp_pc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
      <th>Intercept</th>
      <th>gdp_pc</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8</td>
      <td>a</td>
      <td>1.0</td>
      <td>12.500000</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9</td>
      <td>b</td>
      <td>1.0</td>
      <td>10.555556</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id18">
<h3>列の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.loc[]</span></code>は行と列の抽出に使ったが，追加にも使える。<code class="docutils literal notranslate"><span class="pre">[]</span></code>と同じと考えれば良い。次の例では<code class="docutils literal notranslate"><span class="pre">pop</span></code>を2倍した列を追加している。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;2pop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id19">
<h3>列の削除 <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;2pop&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="drop">
<h3>列の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code><a class="headerlink" href="#drop" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には<code class="docutils literal notranslate"><span class="pre">.drop()</span></code>というメソッドが用意されているので，それを使うことも可能である。</p>
<p>下のコードの説明：</p>
<ul class="simple">
<li><p>オプション<code class="docutils literal notranslate"><span class="pre">axis=</span></code>の値を<code class="docutils literal notranslate"><span class="pre">columns</span></code>の代わりに<code class="docutils literal notranslate"><span class="pre">１</span></code>でも可</p></li>
<li><p>コピーを作るだけなので，元のdfを書き換えたい場合は以下のどちらかが必要</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>に代入する</p></li>
<li><p>オプション<code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">False</span></code>）を追加する。</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Intercept&#39;</span><span class="p">,</span><span class="s1">&#39;gdp_pc&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="c1"># df.drop(&#39;Intercept&#39;, axis=&#39;columns&#39;, inplace=True)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id20">
<h3>行の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>行と列の抽出，そして列の追加に使ったが，行の追加にも使える。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2011</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">215</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2009</th>
      <td>200.0</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>215.0</td>
      <td>100.0</td>
      <td>115.0</td>
      <td>22.0</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>上の例では，最初の4つの要素は整数として入力されたが，<code class="docutils literal notranslate"><span class="pre">df</span></code>の中では浮動小数点に変換されている。</p>
</div>
<div class="section" id="id21">
<h3>行の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>これは列を削除する際に紹介したメソッド<code class="docutils literal notranslate"><span class="pre">.drop()</span></code>である。</p>
<ul class="simple">
<li><p>オプション<code class="docutils literal notranslate"><span class="pre">axis=</span></code>の値を<code class="docutils literal notranslate"><span class="pre">rows</span></code>の代わりに<code class="docutils literal notranslate"><span class="pre">0</span></code>でも可</p></li>
<li><p>コピーを作るだけなので，元のdfを書き換えたい場合は以下のどちらかが必要</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>に代入する</p></li>
<li><p>オプション<code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">False</span></code>）を追加する。</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span>

<span class="c1"># df.drop(2011, axis=0, inplace=True)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id22">
<h2>欠損値の扱い<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>では欠損値は<code class="docutils literal notranslate"><span class="pre">NaN</span></code>と表示されるが，<code class="docutils literal notranslate"><span class="pre">na</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">null</span></code>と呼んだりもする。</p>
<div class="section" id="id23">
<h3>欠損値の確認<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>欠損値があるかどうかの確認は，<code class="docutils literal notranslate"><span class="pre">df.info()</span></code>でもできるが，以下のメソッドを組み合わせることでも可能である。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">isna()</span></code>：それぞれの要素について<code class="docutils literal notranslate"><span class="pre">NaN</span></code>の場合<code class="docutils literal notranslate"><span class="pre">True</span></code>を，そうでない場合は<code class="docutils literal notranslate"><span class="pre">False</span></code>を返す。（<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の全ての要素が<code class="docutils literal notranslate"><span class="pre">True/False</span></code>となる。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code>：<code class="docutils literal notranslate"><span class="pre">df</span></code>の上から下に<strong>行</strong>（rows）を縦断して，それぞれの列の中にある<code class="docutils literal notranslate"><span class="pre">True</span></code>数える。</p>
<ul>
<li><p>デフォルトで引数<code class="docutils literal notranslate"><span class="pre">axis='rows'</span></code>が指定されている。</p></li>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">rows</span></code>は複数！（<code class="docutils literal notranslate"><span class="pre">0</span></code>でも可）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum(axis='columns')</span></code>：<code class="docutils literal notranslate"><span class="pre">df</span></code>の左から右に<strong>列</strong>（columns）を横断して，それぞれの行の中にある<code class="docutils literal notranslate"><span class="pre">True</span></code>を数える。</p>
<ul>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">columns</span></code>は複数！（<code class="docutils literal notranslate"><span class="pre">1</span></code>でも可）</p></li>
</ul>
</li>
</ul>
<p>（注意）<code class="docutils literal notranslate"><span class="pre">sum()</span></code>の<code class="docutils literal notranslate"><span class="pre">axis</span></code>は「行を縦断」か「列を横断」かを指定する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp    0
inv    1
con    2
pop    0
id     0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">inv</span></code>と<code class="docutils literal notranslate"><span class="pre">con</span></code>に<code class="docutils literal notranslate"><span class="pre">NaN</span></code>があることがわかる。<code class="docutils literal notranslate"><span class="pre">axis='columns'</span></code>を設定すると<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行を確認できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    0
2001    0
2002    0
2003    0
2004    0
2005    0
2006    0
2007    0
2008    0
2009    1
2010    2
dtype: int64
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行だけを抽出したい場合がある。その場合はメソッド<code class="docutils literal notranslate"><span class="pre">any()</span></code>が役に立つ。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">any()</span></code>：<code class="docutils literal notranslate"><span class="pre">df</span></code>の上から下に行（<code class="docutils literal notranslate"><span class="pre">rows</span></code>）を縦断して，それぞれの列の中で一つ以上<code class="docutils literal notranslate"><span class="pre">True</span></code>がある場合には<code class="docutils literal notranslate"><span class="pre">True</span></code>を，一つもない場合は<code class="docutils literal notranslate"><span class="pre">False</span></code>を返す。</p>
<ul>
<li><p>デフォルトで引数<code class="docutils literal notranslate"><span class="pre">axis='rows'</span></code>が指定されている。</p></li>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">rows</span></code>は複数！（<code class="docutils literal notranslate"><span class="pre">0</span></code>でも可）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">any(axis='columns')</span></code>：dfの左から右に列（<code class="docutils literal notranslate"><span class="pre">columns</span></code>）を横断して，それぞれの行の中で一つ以上<code class="docutils literal notranslate"><span class="pre">True</span></code>がある場合には<code class="docutils literal notranslate"><span class="pre">True</span></code>を，一つもない場合は<code class="docutils literal notranslate"><span class="pre">False</span></code>を返す。</p>
<ul>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">columns</span></code>は複数！（1でも可）</p></li>
</ul>
</li>
</ul>
<p>（注意）<code class="docutils literal notranslate"><span class="pre">any()</span></code>の<code class="docutils literal notranslate"><span class="pre">axis</span></code>は「行を縦断」か「列を横断」かを指定する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2009</th>
      <td>200.0</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>210.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>これで<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行を抽出することができる。</p>
</div>
<div class="section" id="id24">
<h3>欠損値がある行の削除<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>欠損値がある全ての行を削除する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>115.0</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113.0</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118.0</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119.0</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>このメソッドは，欠損値を削除するとどうなるかを示すだけであり<code class="docutils literal notranslate"><span class="pre">df</span></code>自体は影響は受けない。<code class="docutils literal notranslate"><span class="pre">df</span></code>自体から<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行を削除する場合は<code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>のオプション（デフォルトでは<code class="docutils literal notranslate"><span class="pre">False</span></code>になっている）を加えて</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>とするか，削除後の<code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">df</span></code>自体に再割り当てする。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
<p>また，ある列で<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行のみを削除する場合は，引数<code class="docutils literal notranslate"><span class="pre">subset</span></code>を使う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;inv&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>115.0</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113.0</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118.0</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119.0</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200.0</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20.0</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>（注意）オプション<code class="docutils literal notranslate"><span class="pre">subset=</span></code>には削除する列が１つであってもリスト<code class="docutils literal notranslate"><span class="pre">[]</span></code>で指定する。</p>
</div>
</div>
<div class="section" id="id25">
<h2>並び替え<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">gdp</span></code>の昇順に並び替える。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;gdp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2002</th>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>降順の場合</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010</th>
      <td>210.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>200.0</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119.0</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>118.0</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>115.0</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14.0</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>複数の列を指定する場合</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;gdp&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;True&#39;</span><span class="p">,</span><span class="s1">&#39;False&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2002</th>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>113.0</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>119.0</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ここでは<code class="docutils literal notranslate"><span class="pre">id</span></code>に従って先に並び替えられ，その後に<code class="docutils literal notranslate"><span class="pre">gdp</span></code>に従って並び替えられている。<code class="docutils literal notranslate"><span class="pre">ascending</span></code>は昇順（<code class="docutils literal notranslate"><span class="pre">True</span></code>）か降順（<code class="docutils literal notranslate"><span class="pre">False</span></code>）かを指定する引数であり，<code class="docutils literal notranslate"><span class="pre">['id','gdp']</span></code>と<code class="docutils literal notranslate"><span class="pre">ascending=['True','False']</span></code>の順番が対応している。</p>
</div>
<div class="section" id="id26">
<h2>行インデックスと列ラベル<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id27">
<h3>インデックスを振り直す<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#sec-3-data"><span class="std std-ref">データの読み込みとデータのチェック</span></a>でデータを読み込んだ後，直ぐに<code class="docutils literal notranslate"><span class="pre">.set_index('year')</span></code>を使い，列<code class="docutils literal notranslate"><span class="pre">year</span></code>を行ラベルに設定した。もちろん，必ずしもそうする必要はなく，行インデックス（<code class="docutils literal notranslate"><span class="pre">0</span></code>，<code class="docutils literal notranslate"><span class="pre">1</span></code>，<code class="docutils literal notranslate"><span class="pre">2</span></code>，…）のままで作業をおこなっても全く問題ない。また行ラベルを設定した後に，行インデックスに戻したい場合もあるだろう。その場合には，メソッド<code class="docutils literal notranslate"><span class="pre">.reset_index()</span></code>を使うと，行のインデックスを0,1,2,..と振り直すことができる。<code class="docutils literal notranslate"><span class="pre">df</span></code>を使うと次のようになる。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000</td>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2001</td>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2002</td>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2003</td>
      <td>100.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2004</td>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2005</td>
      <td>115.0</td>
      <td>55.0</td>
      <td>60.0</td>
      <td>14.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2006</td>
      <td>113.0</td>
      <td>50.0</td>
      <td>63.0</td>
      <td>15.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2007</td>
      <td>118.0</td>
      <td>53.0</td>
      <td>65.0</td>
      <td>17.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2008</td>
      <td>119.0</td>
      <td>60.0</td>
      <td>59.0</td>
      <td>18.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2009</td>
      <td>200.0</td>
      <td>62.0</td>
      <td>NaN</td>
      <td>20.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2010</td>
      <td>210.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ここでは行のインデックスが<code class="docutils literal notranslate"><span class="pre">year</span></code>として新たな列として追加されているが、<code class="docutils literal notranslate"><span class="pre">reset_index()</span></code>に引数<code class="docutils literal notranslate"><span class="pre">drop=True</span></code>を加えると，列<code class="docutils literal notranslate"><span class="pre">year</span></code>が自動的に削除されることになる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>1</th>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2</th>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>3</th>
      <td>100.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>4</th>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id28">
<h3>列のラベルの変更<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>メソッド<code class="docutils literal notranslate"><span class="pre">.rename()</span></code>を使い列のラベルを変更する。引数は次の形で設定する。</p>
<div class="math notranslate nohighlight">
\[\text{.rename}\left(\text{columns=}辞書\right)\]</div>
<p>ここで「辞書」は次のルールで指定する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code>:元のラベル</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>：新しいラベル</p></li>
</ul>
<p>下のコードでは，<code class="docutils literal notranslate"><span class="pre">df</span></code>の<code class="docutils literal notranslate"><span class="pre">pop</span></code>を<code class="docutils literal notranslate"><span class="pre">pop_new</span></code>に，<code class="docutils literal notranslate"><span class="pre">id</span></code>を<code class="docutils literal notranslate"><span class="pre">id_new</span></code>に変更している。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span><span class="s1">&#39;pop_new&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="s1">&#39;id_new&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop_new</th>
      <th>id_new</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ただし，再割り当てしないと<code class="docutils literal notranslate"><span class="pre">df</span></code>は変更されないので注意しよう。即ち，上のコードでは<code class="docutils literal notranslate"><span class="pre">df</span></code>の行ラベルは変更されていない。</p>
<p><code class="docutils literal notranslate"><span class="pre">.rename()</span></code>以外にも次のように変更することも可能である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;inv&#39;</span><span class="p">,</span><span class="s1">&#39;con&#39;</span><span class="p">,</span><span class="s1">&#39;pop_new&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>このコードは</p>
<blockquote>
<div><p>右辺の文字列のリストを<code class="docutils literal notranslate"><span class="pre">df.columns</span></code>に割り当てる</p>
</div></blockquote>
<p>と読むことができる。実際このコードにより割り当てが完了し，<code class="docutils literal notranslate"><span class="pre">df</span></code>は変更されることになる。<code class="docutils literal notranslate"><span class="pre">df</span></code>を表示してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop_new</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>さらにもう一つ注意点がある。全ての列ラベルをリストとして準備する必要がある点である。列の数が多いと面倒なので，そういう場合は<code class="docutils literal notranslate"><span class="pre">.rename()</span></code>の方が使いやすいだろう。</p>
</div>
</div>
<div class="section" id="id29">
<h2>よく使うのメソッド<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には様々なメソッドが用意されており，ここでは頻繁に用いるメソッド幾つか紹介しよう。</p>
<div class="section" id="id30">
<h3>統計関連のメソッド<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>上でも出てきたが<code class="docutils literal notranslate"><span class="pre">.sum()</span></code>は各列の合計を返す（<code class="docutils literal notranslate"><span class="pre">axis='rows'</span></code>がデフォルト）。その際，欠損値は無視される。注意する点は合計を計算して意味のある列のみを選択することである。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp        1373.0
inv         415.0
con         610.0
pop_new     155.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>各行の合計を計算したい場合は引数<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">axis='columns'</span></code>を指定する。ここで<code class="docutils literal notranslate"><span class="pre">columns</span></code>となるのは列を横断すると覚えれば良いだろう。古い<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>のバージョンでは自動で文字列を無視していたが，より新しいバージョンでは合計できる列だけを選択する必要がある。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    208.0
2001    199.0
2002    196.0
2003    211.0
2004    232.0
2005    244.0
2006    241.0
2007    253.0
2008    256.0
2009    282.0
2010    231.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>同じ使い方で次のメソッドが利用できる。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.max()</span></code>：最大値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.min()</span></code>：最小値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.mean()</span></code>：（算術）平均</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.std()</span></code>：標準偏差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.var()</span></code>：分散</p></li>
</ul>
<p>次の２つも便利である。計算する際，欠損値は無視され，結果は<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として返される。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.cov()</span></code>：分散共分散行列</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.corr()</span></code>：相関係数</p></li>
</ul>
<p>例えば，<code class="docutils literal notranslate"><span class="pre">.cov()</span></code>を計算してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop_new</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>gdp</th>
      <td>1657.763636</td>
      <td>346.944444</td>
      <td>-50.500000</td>
      <td>152.118182</td>
    </tr>
    <tr>
      <th>inv</th>
      <td>346.944444</td>
      <td>271.388889</td>
      <td>-94.944444</td>
      <td>63.666667</td>
    </tr>
    <tr>
      <th>con</th>
      <td>-50.500000</td>
      <td>-94.944444</td>
      <td>44.444444</td>
      <td>-20.333333</td>
    </tr>
    <tr>
      <th>pop_new</th>
      <td>152.118182</td>
      <td>63.666667</td>
      <td>-20.333333</td>
      <td>20.090909</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>対角成分は分散であり，その他は行と列のラベルに対応する共分散となる。<code class="docutils literal notranslate"><span class="pre">.corr()</span></code>も同じ位置関係となる。</p>
<p>また変数の変化率（成長率）を計算するには<code class="docutils literal notranslate"><span class="pre">.pct_change()</span></code>が便利である（percent changeの略）。これは毎期ごとの変化率を返すことになる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop_new</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>-0.050000</td>
      <td>0.250000</td>
      <td>-0.125000</td>
      <td>0.125000</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>-0.021053</td>
      <td>-0.160000</td>
      <td>0.028571</td>
      <td>0.111111</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>0.075269</td>
      <td>0.428571</td>
      <td>-0.027778</td>
      <td>0.100000</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>0.100000</td>
      <td>0.300000</td>
      <td>0.014286</td>
      <td>0.090909</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>0.045455</td>
      <td>0.410256</td>
      <td>-0.154930</td>
      <td>0.166667</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>-0.017391</td>
      <td>-0.090909</td>
      <td>0.050000</td>
      <td>0.071429</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>0.044248</td>
      <td>0.060000</td>
      <td>0.031746</td>
      <td>0.133333</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>0.008475</td>
      <td>0.132075</td>
      <td>-0.092308</td>
      <td>0.058824</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>0.680672</td>
      <td>0.033333</td>
      <td>0.000000</td>
      <td>0.111111</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>0.050000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.050000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">1999</span></code>年が無いため，<code class="docutils literal notranslate"><span class="pre">2000</span></code>年の成長率は欠損値となっている。<code class="docutils literal notranslate"><span class="pre">.pct_change()</span></code>と<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>を続けて書くと簡単に（算術）平均成長率を計算することができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp        0.091567
inv        0.136333
con       -0.027541
pop_new    0.101838
dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id31">
<h3>その他<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>列<code class="docutils literal notranslate"><span class="pre">id</span></code>には文字列があり，行のデータをカテゴリー別に分けていると考えることができる。メソッド<code class="docutils literal notranslate"><span class="pre">.unique()</span></code>を使うと，選択した列に重複したデータがある場合，ユニークなものだけを抽出できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;a&#39;, &#39;b&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>まな類似するメソッドに<code class="docutils literal notranslate"><span class="pre">.nunique()</span></code>があり，カテゴリー数を返す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<p>関連するメソッドに<code class="docutils literal notranslate"><span class="pre">.value_counts()</span></code>がある。これを使うとカテゴリーの内訳を確認するすることができる。カテゴリーの行数を表示するには</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    6
b    5
Name: id, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>とする。引数<code class="docutils literal notranslate"><span class="pre">normalize=True</span></code>を追加すると，頻度（パーセント）として表示できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    0.545455
b    0.454545
Name: id, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>のように行数が少ない<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の場合，これらのメソッドの有用性を見出すことは難しいが，何千行あるデータを扱っていると想像してみよう。そのような大きなデータを扱う場合は非常に重宝するメソッドとなる。</p>
</div>
</div>
<div class="section" id="series">
<h2><code class="docutils literal notranslate"><span class="pre">Series</span></code>について<a class="headerlink" href="#series" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>について簡単に説明する。<code class="docutils literal notranslate"><span class="pre">Series</span></code>はスプレッド・シートから１つの行または列を取り出したようなデータとイメージすれば良いだろう。まず<code class="docutils literal notranslate"><span class="pre">df</span></code>の列<code class="docutils literal notranslate"><span class="pre">gdp</span></code>から<code class="docutils literal notranslate"><span class="pre">Series</span></code>を作ってみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
<span class="n">s</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2000    100.0
2001     95.0
2002     93.0
2003    100.0
2004    110.0
2005    115.0
2006    113.0
2007    118.0
2008    119.0
2009    200.0
2010    210.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>もしくは</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>で列を抽出すると<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>が返される。また次のように<code class="docutils literal notranslate"><span class="pre">s</span></code>のメソッド<code class="docutils literal notranslate"><span class="pre">.to_frame()</span></code>を使うと<code class="docutils literal notranslate"><span class="pre">Series</span></code>を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>に変換できるので、覚えておくと便利かも知れない。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h3>構成要素<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>この例を使い<code class="docutils literal notranslate"><span class="pre">Series</span></code>の構成要素について説明する。</p>
<ul class="simple">
<li><p>データ：<code class="docutils literal notranslate"><span class="pre">s.to_numpy()</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">s.values</span></code>で抽出可能</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code>名：<code class="docutils literal notranslate"><span class="pre">s.name</span></code>で抽出可能</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の列ラベルから引き継がれているが、空の場合もある。</p></li>
</ul>
</li>
<li><p>インデックス・ラベル（index label）：<code class="docutils literal notranslate"><span class="pre">s.index</span></code>で抽出可能</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の行ラベルから引き継がれている</p></li>
<li><p>インデックス（index）は<code class="docutils literal notranslate"><span class="pre">0</span></code>,<code class="docutils literal notranslate"><span class="pre">1</span></code>,<code class="docutils literal notranslate"><span class="pre">2</span></code>,…の順番で表される。</p></li>
</ul>
</li>
<li><p>インデックス名：<code class="docutils literal notranslate"><span class="pre">s.index.name</span></code>で抽出可能</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の行ラベル名から引き継がれていが、空の場合もある。</p></li>
</ul>
</li>
</ul>
<p>まずデータ自体を抽出する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([100.,  95.,  93., 100., 110., 115., 113., 118., 119., 200., 210.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy.ndarray
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>名の抽出</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;gdp&#39;
</pre></div>
</div>
</div>
</div>
<p>インデックスの抽出</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Int64Index([2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010], dtype=&#39;int64&#39;, name=&#39;year&#39;)
</pre></div>
</div>
</div>
</div>
<p>戻り値の最後に<code class="docutils literal notranslate"><span class="pre">name='year'</span></code>とあるように、インデックス名は<code class="docutils literal notranslate"><span class="pre">year</span></code>であり、次のコードでアクスすできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;year&#39;
</pre></div>
</div>
</div>
</div>
<p>また<code class="docutils literal notranslate"><span class="pre">dtype='int64'</span></code>とあるが、インデックスは整数であることがわかる。</p>
</div>
<div class="section" id="id33">
<h3>要素の抽出<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>要素の抽出方法は<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>の<code class="docutils literal notranslate"><span class="pre">array</span></code>と辞書に似ている。この点を説明するために、次のコードを使い<code class="docutils literal notranslate"><span class="pre">s</span></code>からインデックスを文字列に変換した<code class="docutils literal notranslate"><span class="pre">s_new</span></code>を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s_new</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">s_new</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">&#39;abcdefghijk&#39;</span><span class="p">]</span>
<span class="n">s_new</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    100.0
b     95.0
c     93.0
d    100.0
e    110.0
f    115.0
g    113.0
h    118.0
i    119.0
j    200.0
k    210.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>１行目：<code class="docutils literal notranslate"><span class="pre">s</span></code>のコピーを作り<code class="docutils literal notranslate"><span class="pre">s_new</span></code>に割り当てる。</p>
<p>２行目の右辺：内包表記を使い次のリストを作成する。</p>
<p><code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b',</span> <span class="pre">'c',</span> <span class="pre">'d',</span> <span class="pre">'e',</span> <span class="pre">'f',</span> <span class="pre">'g',</span> <span class="pre">'h',</span> <span class="pre">'i',</span> <span class="pre">'j',</span> <span class="pre">'k']</span></code></p>
<p>２行目：<code class="docutils literal notranslate"><span class="pre">s_new</span></code>のインデックス・ラベルを変更
３行目：<code class="docutils literal notranslate"><span class="pre">s_new</span></code>の表示</p>
</div></blockquote>
<p>まずインデックスを使い一つの要素の抽出は次のようにする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s_new</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>115.0
</pre></div>
</div>
</div>
</div>
<p>複数のインデックスを使うことも可能である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s_new</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b     95.0
d    100.0
f    115.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>これは<code class="docutils literal notranslate"><span class="pre">array</span></code>と同じである。またスライシングも同様にできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s_new</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>f    115.0
g    113.0
h    118.0
i    119.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">s</span></code>の場合、順番を表すインデックスで要素アクセスしようとするとエラーが発生する。これはラベルが整数<code class="docutils literal notranslate"><span class="pre">2000,2001...</span></code>になっている理由のようである。この場合は、ラベルである<code class="docutils literal notranslate"><span class="pre">2000</span></code>や<code class="docutils literal notranslate"><span class="pre">2008</span></code>を使い次のようにするとエラーは発生しない。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="p">[</span><span class="mi">2000</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>次にラベルを使った要素のアクセス方法を考える。この場合は辞書と同じ形になる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s_new</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>95.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s_new</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b     95.0
e    110.0
j    200.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id34">
<h3>統計学関連メソッド<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>にも<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>と同じような統計学関連メソッドが実装されているので，<code class="docutils literal notranslate"><span class="pre">see</span></code>で調べてみよう。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">see</span><span class="p">(</span><span class="n">s_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    .*               []               in               +                +=
    -                -=               *                *=               @
    /                /=               //               //=              %
    %=               **               **=              &amp;                &amp;=
    ^                ^=               |                |=               +obj
    -obj             ~                &lt;                &lt;=               ==
    !=               &gt;                &gt;=               abs()            bool()
    dir()            divmod()         float()          hash()           help()
    int()            iter()           len()            repr()
    round()          str()            .T               .a               .abs()
    .add()           .add_prefix()    .add_suffix()    .agg()
    .aggregate()     .align()         .all()           .any()
    .append()        .apply()         .argmax()        .argmin()
    .argsort()       .array           .asfreq()        .asof()
    .astype()        .at              .at_time()       .attrs
    .autocorr()      .axes            .b               .backfill()
    .between()       .between_time()                   .bfill()
    .bool()          .c               .clip()          .combine()
    .combine_first()                  .compare()       .convert_dtypes()
    .copy()          .corr()          .count()         .cov()
    .cummax()        .cummin()        .cumprod()       .cumsum()        .d
    .describe()      .diff()          .div()           .divide()
    .divmod()        .dot()           .drop()          .drop_duplicates()
    .droplevel()     .dropna()        .dtype           .dtypes
    .duplicated()    .e               .empty           .eq()
    .equals()        .ewm()           .expanding()     .explode()       .f
    .factorize()     .ffill()         .fillna()        .filter()
    .first()         .first_valid_index()              .flags
    .floordiv()      .g               .ge()            .get()
    .groupby()       .gt()            .h               .hasnans
    .head()          .hist()          .i               .iat
    .idxmax()        .idxmin()        .iloc()          .index
    .infer_objects()                  .interpolate()
    .is_monotonic    .is_monotonic_decreasing
    .is_monotonic_increasing          .is_unique       .isin()
    .isna()          .isnull()        .item()          .items()
    .iteritems()     .j               .k               .keys()
    .kurt()          .kurtosis()      .last()          .last_valid_index()
    .le()            .loc()           .lt()            .mad()           .map()
    .mask()          .max()           .mean()          .median()
    .memory_usage()                   .min()           .mod()
    .mode()          .mul()           .multiply()      .name
    .nbytes          .ndim            .ne()            .nlargest()
    .notna()         .notnull()       .nsmallest()     .nunique()       .pad()
    .pct_change()    .pipe()          .plot()          .pop()           .pow()
    .prod()          .product()       .quantile()      .radd()
    .rank()          .ravel()         .rdiv()          .rdivmod()
    .reindex()       .reindex_like()                   .rename()
    .rename_axis()                    .reorder_levels()
    .repeat()        .replace()       .resample()      .reset_index()
    .rfloordiv()     .rmod()          .rmul()          .rolling()
    .round()         .rpow()          .rsub()          .rtruediv()
    .sample()        .searchsorted()                   .sem()
    .set_axis()      .set_flags()     .shape           .shift()         .size
    .skew()          .slice_shift()                    .sort_index()
    .sort_values()                    .squeeze()       .std()           .sub()
    .subtract()      .sum()           .swapaxes()      .swaplevel()
    .tail()          .take()          .to_clipboard()
    .to_csv()        .to_dict()       .to_excel()      .to_frame()
    .to_hdf()        .to_json()       .to_latex()      .to_list()
    .to_markdown()                    .to_numpy()      .to_period()
    .to_pickle()     .to_sql()        .to_string()     .to_timestamp()
    .to_xarray()     .transform()     .transpose()     .truediv()
    .truncate()      .tz_convert()    .tz_localize()
    .unique()        .unstack()       .update()        .value_counts()
    .values          .var()           .view()          .where()         .xs()
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id35">
<h2>グループ計算<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<p>上で使った<code class="docutils literal notranslate"><span class="pre">df</span></code>を表示してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop_new</th>
      <th>id</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000</th>
      <td>100.0</td>
      <td>20.0</td>
      <td>80.0</td>
      <td>8.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>95.0</td>
      <td>25.0</td>
      <td>70.0</td>
      <td>9.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>93.0</td>
      <td>21.0</td>
      <td>72.0</td>
      <td>10.0</td>
      <td>a</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>100.0</td>
      <td>30.0</td>
      <td>70.0</td>
      <td>11.0</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>110.0</td>
      <td>39.0</td>
      <td>71.0</td>
      <td>12.0</td>
      <td>a</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>のメソッド<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>を使うと列の平均を簡単に計算できる。列を取り出して計算してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>inv        41.500000
con        67.777778
pop_new    14.090909
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>一方で，列<code class="docutils literal notranslate"><span class="pre">id</span></code>には<code class="docutils literal notranslate"><span class="pre">a</span></code>と<code class="docutils literal notranslate"><span class="pre">b</span></code>があり，<code class="docutils literal notranslate"><span class="pre">df</span></code>を２つのグループに分けることができる。ここで問題になるのは，グループ別に列の平均を計算したい場合である。まず考えられる方法は<code class="docutils literal notranslate"><span class="pre">a</span></code>グループだけを抽出して平均を計算し，同じように<code class="docutils literal notranslate"><span class="pre">b</span></code>も計算するということだろう。もしグループ数が多い場合は<code class="docutils literal notranslate"><span class="pre">for</span></code>ループが必要になり，より長いコードを書く必要が発生し面倒に感じることになる。</p>
<p>こういう場合のために，<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には簡単にグループ計算を可能にする方法が用意されている。それが<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>というメソッドである。以下では<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>の使い方を<code class="docutils literal notranslate"><span class="pre">df</span></code>を使って３つのステップに分けて説明する。</p>
<div class="section" id="id36">
<h3>ステップ１：グループ化する列を指定<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>最初のステップでは，<strong>グループ化したい列名</strong>を引数として<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>を実行する。<code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">id</span></code>でグループ化したいので次のコードとなる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>＜注意＞</strong><br>
このコードは<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>を返すわけでは<strong>ない</strong>。返すのはグループ計算用のオブジェクトであり，それを使ってグループ計算をおこなう事になる。</p>
<p>実際にコードを実行し，変数<code class="docutils literal notranslate"><span class="pre">df_groupby</span></code>に割り当てよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df_groupby</span></code>を実行してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x11b011a90&gt;
</pre></div>
</div>
</div>
</div>
<p>何も返されない。表示されているのは，PCメモリーのある箇所に<code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code>というオブジェクトが存在すると伝えているだけである。</p>
</div>
<div class="section" id="id37">
<h3>ステップ２：グループ計算したい列を指定<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>次にグループ計算したい列を指定するが，次の様な書き方となる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>df_groupby[＜グループ計算したい列ラベル＞]
</pre></div>
</div>
<p>ここで<code class="docutils literal notranslate"><span class="pre">[]</span></code>を使っていることに注意しよう。例として<code class="docutils literal notranslate"><span class="pre">gdp</span></code>をグループ計算するとしよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.SeriesGroupBy object at 0x11cc81ca0&gt;
</pre></div>
</div>
</div>
</div>
<p>ここでも新たなオブジェクト<code class="docutils literal notranslate"><span class="pre">SeriesGroupBy</span></code>のメモリーアドレスが表示されるだけである。どの様に計算するかを指定することにより，計算結果が返されることになる。それが次のステップである。</p>
</div>
<div class="section" id="id38">
<h3>ステップ３：計算方法の指定<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>ステップ１と２がグループ計算の準備段階であり，あとは実際にどのように計算したいかを指定する。例として，平均を考えてみよう。上でも出てきたが，平均はメソッド<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>を使う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id
a    124.166667
b    125.600000
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>グループ計算結果は<code class="docutils literal notranslate"><span class="pre">Series</span></code>として返されている。<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>以外にも使える関数は準備されいる。<code class="docutils literal notranslate"><span class="pre">see()</span></code>を使って属性・メソッドを調べてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">see</span><span class="p">(</span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    .*              []              &lt;               &lt;=              ==
    !=              &gt;               &gt;=              dir()           hash()
    iter()          len()           repr()          str()           .agg()
    .aggregate()    .all()          .any()          .apply()
    .backfill()     .bfill()        .corr()         .count()        .cov()
    .cumcount()     .cummax()       .cummin()       .cumprod()      .cumsum()
    .describe()     .diff()         .dtype          .ewm()
    .expanding()    .ffill()        .fillna()       .filter()       .first()
    .get_group()    .groups         .head()         .hist()         .idxmax()
    .idxmin()       .indices        .is_monotonic_decreasing
    .is_monotonic_increasing        .last()         .mad()          .max()
    .mean()         .median()       .min()          .ndim           .ngroup()
    .ngroups        .nlargest()     .nsmallest()    .nth()          .nunique()
    .ohlc()         .pad()          .pct_change()                   .pipe()
    .plot()         .prod()         .quantile()     .rank()
    .resample()     .rolling()      .sample()       .sem()          .shift()
    .size()         .skew()         .std()          .sum()          .tail()
    .take()         .transform()    .tshift()       .unique()
    .value_counts()                 .var()
</pre></div>
</div>
</div>
</div>
<p>主なメソッドとして次を挙げることができる（これらの計算で欠損値は無視される）。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mean()</span></code>：平均</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">median()</span></code>：中央値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max()</span></code>：最大値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min()</span></code>：最小値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std()</span></code>：標準偏差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var()</span></code>：分散</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code>：合計</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cumsum()</span></code>：累積和</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">first()</span></code>：最初の値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last()</span></code>：最後の値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">count()</span></code>：要素数</p></li>
<li><p>などなど</p></li>
</ul>
<p>このリストにない計算をしたい場合もあるだろう。その場合は，上のリストにもある<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>（<code class="docutils literal notranslate"><span class="pre">aggregate()</span></code>も同じ）を使い<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>や自作の関数を指定する。例えば，<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>の<code class="docutils literal notranslate"><span class="pre">np.mean()</span></code>で平均を計算する場合は次の様になる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id
a    124.166667
b    125.600000
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>次に平均を計算する自作の関数<code class="docutils literal notranslate"><span class="pre">my_mean</span></code>を考えてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>ここでの<code class="docutils literal notranslate"><span class="pre">x</span></code>はステップ２で指定する計算する対象の列と考えれば良いだろう。実際に実行してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">my_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id
a    124.166667
b    125.600000
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">np.mean</span></code>の場合も<code class="docutils literal notranslate"><span class="pre">my_mean</span></code>の場合も<code class="docutils literal notranslate"><span class="pre">()</span></code>がなく，関数名だけを<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>の引数にしている。関数名だけを<code class="docutils literal notranslate"><span class="pre">.agg</span></code>に渡し，<code class="docutils literal notranslate"><span class="pre">.agg</span></code>が渡された関数を実行するというイメージである。<code class="docutils literal notranslate"><span class="pre">()</span></code>を付けると<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>に渡す前に関数を実行することになりエラーとなってしまう。</p>
</div>
</div>
<div class="section" id="id39">
<h3>次のステップ<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id40">
<h4>１行で書く<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<p>上の説明では３つのステップに分けたが，もちろん次のように３つのステップを次のように１行で書いても構わないし，むしろその場合が多いだろう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id
a    124.166667
b    125.600000
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>このコードは次の様に読むことができる。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">id</span></code>でグループ分けして，<code class="docutils literal notranslate"><span class="pre">gdp</span></code>の平均を計算する。</p>
</div></blockquote>
</div>
<div class="section" id="id41">
<h4>複数選択<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<p>各ステップでは列や関数を一つだけ選択・設定しているが，それぞれ複数選択することも可能である。</p>
<ul class="simple">
<li><p>ステップ１ではグループ化する上で基準となる列を複数選択</p></li>
<li><p>ステップ２では計算対象となる列を複数選択</p></li>
<li><p>ステップ３では<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>の引数に複数の関数を指定</p></li>
</ul>
<p>という具合である。ただその場合は，リストとして列や関数名を指定する必要がある。例えば，ステップ２で<code class="docutils literal notranslate"><span class="pre">gdp</span></code>と<code class="docutils literal notranslate"><span class="pre">inv</span></code>を選ぶとしよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;inv&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>124.166667</td>
      <td>38.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>125.600000</td>
      <td>45.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>結果は<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として返されている。ステップ１もしくは３で複数選択すると<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>が<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>（階層的な行と列）として返されることになるが，その簡単な説明については<a class="reference external" href="https://py4basics.github.io/Gapminder.html">Gapminder</a>を参照して欲しい。より詳しい説明は他のサイトに譲ることにする。</p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>のような小さな<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>では<code class="docutils literal notranslate"><span class="pre">.groupby</span></code>の威力はあまりピンとこないかも知れない。しかし大きな<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>を使うとその恩恵を強く感じることだろう。<a class="reference external" href="https://py4basics.github.io/Gapminder.html">Gapminder</a>ではマクロ経済データを使い<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>の使い方の例を示している。興味がある人は是非！</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="2_NumPy.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">NumPy</span></code>：高速化</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="4_matplotlib.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">Matplotlib</span></code>：図示</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By 春山 鉄源  Tetsugen HARUYAMA<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>