
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pandas：データ分析 &#8212; 経済学のためのPython入門</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="_static/myadmonitions.css?v=372cf325" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-R9KXY9G892"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-R9KXY9G892');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-R9KXY9G892');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '3_Pandas';</script>
    <link rel="canonical" href="https://py4basics.github.io/3_Pandas.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Matplotlib：図示" href="4_matplotlib.html" />
    <link rel="prev" title="NumPy：高速化" href="2_NumPy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">経済学のためのPython入門</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Python入門I</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_Basics_I.html">基本データ型と変数</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Basics_II.html">データの操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Basics_III.html">関数とメソッド</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Basics_IV.html">制御フロー</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Basics_V.html">モジュールとアルゴリズム</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Basics_VI.html">図示とシミュレーション</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python入門II</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2_NumPy.html"><code class="docutils literal notranslate"><span class="pre">NumPy</span></code>：高速化</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>：データ分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_matplotlib.html"><code class="docutils literal notranslate"><span class="pre">Matplotlib</span></code>：図示</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_pandas_plot.html"><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>：図示</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_SciPy_optimize.html"><code class="docutils literal notranslate"><span class="pre">SciPy.optimize</span></code>：解の求め方と最適化問題</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_NumPy_random.html"><code class="docutils literal notranslate"><span class="pre">Numpy</span></code>: ランダム変数</a></li>
<li class="toctree-l1"><a class="reference external" href="https://py4etrics.github.io/5_SciPy_stats.html">SciPy.stats：確率分布</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">参考</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_Preparations.html">ツールのインストールと説明</a></li>
<li class="toctree-l1"><a class="reference internal" href="things_to_note.html">Tipsと注意点</a></li>
<li class="toctree-l1"><a class="reference internal" href="pseudo_code.html">疑似コード</a></li>
<li class="toctree-l1"><a class="reference internal" href="Grade.html">学業成績の分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gapminder.html">Gapminder</a></li>
<li class="toctree-l1"><a class="reference internal" href="Moving_Average.html">移動平均</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">経済学</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://py4macro.github.io">Pythonで学ぶマクロ経済学（中級＋レベル）</a></li>
<li class="toctree-l1"><a class="reference external" href="https://py4etrics.github.io">Pythonで学ぶ入門計量経済学</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">JupyterLite</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://py4class.netlify.app">JupyterLiteを始める</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Py4Basics/py4basics.github.io/source?urlpath=tree/3_Pandas.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/Py4Basics/py4basics.github.io/blob/source/3_Pandas.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/Py4Basics/py4basics.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/3_Pandas.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Pandas：データ分析</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">説明</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sec-3-data">データの読み込みとデータのチェック</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe"><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の構成要素</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">要素の抽出</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">説明</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loc"><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>（ラベル使用）</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iloc"><code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>（インデックス使用）</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><code class="docutils literal notranslate"><span class="pre">[]</span></code>で列の選択（ラベル使用）</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">ある条件の下で行の抽出</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">１つの条件の場合</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gdp1200">例１：GDPが1200未満の行の抽出</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#continentasia">例２：<code class="docutils literal notranslate"><span class="pre">continent</span></code>が<code class="docutils literal notranslate"><span class="pre">Asia</span></code>の行を抽出</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">複数条件の場合</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">例３</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">例４</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">例５</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#query"><code class="docutils literal notranslate"><span class="pre">query()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">例１の場合：</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">例２の場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">例３の場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">例４の場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">例５の場合</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">列と行の追加と削除</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">列の追加 <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">列の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#del">列の削除 <code class="docutils literal notranslate"><span class="pre">del</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drop">列の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">行の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">行の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">欠損値の扱い</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">欠損値の確認</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">欠損値がある行の削除</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">並び替え</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">行番号と列ラベル</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">行番号を振り直す</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">列のラベルの変更</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">よく使うメソッド</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">統計関連のメソッド</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">その他</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series"><code class="docutils literal notranslate"><span class="pre">Series</span></code>について</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">構成要素</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">要素の抽出</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">統計学関連メソッド</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">グループ計算</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">ステップ１：グループ化する列を指定</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">ステップ２：グループ計算したい列を指定</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">ステップ３：計算方法の指定</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">次のステップ</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">１行で書く</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">複数選択</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pandas">
<span id="chap-pandas"></span><h1><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>：データ分析<a class="headerlink" href="#pandas" title="Link to this heading">#</a></h1>
<div name="html-admonition" style="font-size: 0.8em">
<input type="button" onclick="location.href='https://translate.google.com/translate?hl=&sl=ja&tl=en&u='+window.location;" value="Google translation" style="color:#ffffff;background-color:#008080; height:25px" onmouseover="this.style.background='#99ccff'" onmouseout="this.style.background='#008080'"/> in English or the language of your choice.
</div><br><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">py4macro</span>

<span class="c1"># 警告メッセージを非表示</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h2>説明<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>はデータを扱う上で欠かせないパッケージであり，エクセルをイメージすれば良いだろう。<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>にはエクセルのスプレッド・シートに対応する<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>（データ・フレーム）と<code class="docutils literal notranslate"><span class="pre">Series</span></code>（シリーズ）呼ばれるオブジェクトがあり，それらを駆使してデータ分析をおこなう。</p>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>は次の表の様になっている。まず、用語の整理をしよう。</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>X</p></th>
<th class="head"><p>Y</p></th>
<th class="head"><p>Z</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>10</p></td>
<td><p>5.0</p></td>
<td><p>3.0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>20</p></td>
<td><p>30.0</p></td>
<td><p>2.0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>30</p></td>
<td><p>15.0</p></td>
<td><p>5.0</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><strong>列</strong>とは縦に沿ったデータの集まりであり、<code class="docutils literal notranslate"><span class="pre">X</span></code>の列には<code class="docutils literal notranslate"><span class="pre">10</span></code>、<code class="docutils literal notranslate"><span class="pre">20</span></code>、<code class="docutils literal notranslate"><span class="pre">30</span></code>がある。<code class="docutils literal notranslate"><span class="pre">Y</span></code>と<code class="docutils literal notranslate"><span class="pre">Z</span></code>も同様にそれぞれの値から構成される列となる。</p></li>
<li><p><strong>行</strong>とは横に沿ったデータの集まりであり、<code class="docutils literal notranslate"><span class="pre">0</span></code>の行には<code class="docutils literal notranslate"><span class="pre">10</span></code>、<code class="docutils literal notranslate"><span class="pre">5.0</span></code>、<code class="docutils literal notranslate"><span class="pre">3.0</span></code>がある。<code class="docutils literal notranslate"><span class="pre">1</span></code>と<code class="docutils literal notranslate"><span class="pre">2</span></code>も同様にそれぞれの値から構成される行となる。</p></li>
<li><p><strong>インデックス</strong>とは<strong>行</strong>を特定するための数字やラベル（文字列）を表し、上の例では左側に縦に並ぶ<code class="docutils literal notranslate"><span class="pre">0</span></code>、<code class="docutils literal notranslate"><span class="pre">1</span></code>、<code class="docutils literal notranslate"><span class="pre">2</span></code>がインデックスである。インデックスには２種類がある。</p>
<ul>
<li><p><strong>位置番号</strong>：上の例では、<code class="docutils literal notranslate"><span class="pre">0</span></code>は<code class="docutils literal notranslate"><span class="pre">0</span></code>番目の行を、<code class="docutils literal notranslate"><span class="pre">1</span></code>は<code class="docutils literal notranslate"><span class="pre">1</span></code>番目の行を、<code class="docutils literal notranslate"><span class="pre">2</span></code>は<code class="docutils literal notranslate"><span class="pre">2</span></code>番目の行を示す。このサイトでは、これを<strong>インデックス番号</strong>もしくは<strong>行番号</strong>と呼ぶ。</p></li>
<li><p><strong>ラベル</strong>：各行を特定するための整数や文字列となる。以下で<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の詳細な説明をする際に<code class="docutils literal notranslate"><span class="pre">df</span></code>という変数に<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>を割り当てるが、そこでは国名（文字列）がラベルに使われている。このサイトでは、これを<strong>行ラベル</strong>と呼ぶ。</p></li>
</ul>
</li>
<li><p><strong>列</strong>のラベルと位置番号</p>
<ul>
<li><p><strong>ラベル</strong>：列を特定するための整数や文字列を指す。上の例では、<code class="docutils literal notranslate"><span class="pre">X</span></code>，<code class="docutils literal notranslate"><span class="pre">Y</span></code>，<code class="docutils literal notranslate"><span class="pre">Z</span></code>がラベルであり、このサイトでは<strong>列ラベル</strong>と呼ぶ。</p></li>
<li><p><strong>位置番号</strong>：上の例では、<code class="docutils literal notranslate"><span class="pre">X</span></code>は<code class="docutils literal notranslate"><span class="pre">0</span></code>番目の列を、<code class="docutils literal notranslate"><span class="pre">Y</span></code>は<code class="docutils literal notranslate"><span class="pre">1</span></code>番目の列を、<code class="docutils literal notranslate"><span class="pre">Z</span></code>は<code class="docutils literal notranslate"><span class="pre">2</span></code>番目の列を示す。このサイトでは、これを<strong>列番号</strong>と呼ぶ。</p></li>
</ul>
</li>
<li><p>上の例では行番号と列ラベル以外の数字がデータとなっている。</p></li>
</ul>
<p>上の表のように、<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>は１つ以上の行と列から構成されている。一方、<code class="docutils literal notranslate"><span class="pre">Series</span></code>には１つの列（もしくは行と考えることもできる）のみしかない点が大きな違いである。</p>
<p>これらの特徴により複雑なデータの扱いが簡単になる。例えば，<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>を使うと目的のデータにアクセスしたい場合、行番号と列番号を把握する必要がある。一方、<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>では行と列にラベルを使うことにより（例えば，行<code class="docutils literal notranslate"><span class="pre">Japan</span></code>の列<code class="docutils literal notranslate"><span class="pre">gdp</span></code>のようにデータを特定することが可能となる），データの操作が非常に簡単になる。また，<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>は<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>に基づいているため，ベクトル演算の機能が使える。</p>
<p>ここで説明できない他の使い方については<a class="reference external" href="https://github.com/ysdyt/pandas_tutorial">このサイト</a>と<a class="reference external" href="https://note.nkmk.me/python-pandas-post-summary/">このサイト</a>が参考になるだろう。</p>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>は通常<code class="docutils literal notranslate"><span class="pre">pd</span></code>という名前で読み込む。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</section>
<section id="sec-3-data">
<span id="id2"></span><h2>データの読み込みとデータのチェック<a class="headerlink" href="#sec-3-data" title="Link to this heading">#</a></h2>
<p>様々なデータを読み込むことが可能だが，ここでは<code class="docutils literal notranslate"><span class="pre">read_csv()</span></code>関数を使って<code class="docutils literal notranslate"><span class="pre">.csv</span></code>ファイルを読み込むことにする。（<code class="docutils literal notranslate"><span class="pre">csv</span></code>はcomma separated valuesの略称であり、.csvファイルについては<a class="reference external" href="https://www.google.com/search?q=csv%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A8%E3%81%AF">この検索結果</a>を参照）ここで使う<code class="docutils literal notranslate"><span class="pre">data1.csv</span></code>は<a class="reference external" href="https://raw.githubusercontent.com/Py4Basics/py4basics.github.io/source/data/data1.csv">ここをクリック</a>をマウスの右クリックすることによりダウンロードすることもできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの読み込み</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/data1.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>全体を表示させる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>China</td>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>France</td>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Germany</td>
      <td>4274</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3</th>
      <td>India</td>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Italy</td>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Japan</td>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Korea</td>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Singapore</td>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Taiwan</td>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>9</th>
      <td>UK</td>
      <td>2994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>数値はPenn World Tableと呼ばれるデータセットに基づき作成している。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">country</span></code>：国名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>：国内総生産（Gross Domestic Product, current PPPs; in billions 2011US$）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span></code>：消費（consumption, current PPPs; in billions 2011US$）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inv</span></code>：投資（investment, current PPPs; in billions 2011US$）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pop</span></code>：人口（population, in millions）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">continent</span></code>：大陸（continent）</p></li>
</ul>
<p>行はインデックス（番号）になっており，そのまま使っても全く問題ない。ここでは列<code class="docutils literal notranslate"><span class="pre">country</span></code>を行ラベルに設定して<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>の使い方について説明することにする。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set_index()</span></code>：引数の列を行ラベルにするメソッド（行ラベルは文字列とすること）</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.set_index('country')</span></code>は直接<code class="docutils literal notranslate"><span class="pre">df</span></code>に影響を与えない。単に，書き換えるとどうなるかを表示しているだけとなる。ここでは<code class="docutils literal notranslate"><span class="pre">df</span></code>に再度割り当てることにより<code class="docutils literal notranslate"><span class="pre">df</span></code>自体を上書きしている。</p></li>
<li><p>出力にある<code class="docutils literal notranslate"><span class="pre">NaN</span></code>（Not a Number）は欠損値を示す。</p></li>
<li><p>行ラベルに<code class="docutils literal notranslate"><span class="pre">country</span></code>という列ラベルが残るが，それを消すにはメソッド<code class="docutils literal notranslate"><span class="pre">.rename_axis('')</span></code>を使うと良いだろう。ここで<code class="docutils literal notranslate"><span class="pre">''</span></code>は空の文字列である。<code class="docutils literal notranslate"><span class="pre">.rename_axis(None)</span></code>でも同じ結果となる。もしくは次のコードでも良い。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
</pre></div>
</div>
</div>
<p>行数が多い場合（例えば，10000）、全てを表示してもあまり意味がない。そこでよく使う<code class="docutils literal notranslate"><span class="pre">df</span></code>のメソッドに、最初や最後の数行だけを表示するメソッド<code class="docutils literal notranslate"><span class="pre">.head()</span></code>と<code class="docutils literal notranslate"><span class="pre">.tail()</span></code>を紹介する。</p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>の最初の５行を表示させる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>引数に<code class="docutils literal notranslate"><span class="pre">2</span></code>を指定すると最初の<code class="docutils literal notranslate"><span class="pre">2</span></code>行のみ表示される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>最後の<code class="docutils literal notranslate"><span class="pre">5</span></code>行を表示させる。引数に整数を入れて表示行数を指定することも可能。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>次に<code class="docutils literal notranslate"><span class="pre">df</span></code>の情報の特徴を確認するメソッド<code class="docutils literal notranslate"><span class="pre">.info()</span></code>を使ってみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 10 entries, China to UK
Data columns (total 5 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   gdp        10 non-null     int64  
 1   con        9 non-null      float64
 2   inv        8 non-null      float64
 3   pop        10 non-null     int64  
 4   continent  10 non-null     object 
dtypes: float64(2), int64(2), object(1)
memory usage: 480.0+ bytes
</pre></div>
</div>
</div>
</div>
<p><strong>説明</strong>：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'pandas.core.frame.DataFrame'&gt;</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code>とはデータ型と同じ意味である。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pandas.core.frame.DataFrame</span></code>がデータ型名でありクラス名でもある。</p></li>
<li><p>例えば、<code class="docutils literal notranslate"><span class="pre">type(1)</span></code>を実行すると<code class="docutils literal notranslate"><span class="pre">int</span></code>（整数型）というデータ型が表示するが，これはクラス名でもある。<code class="docutils literal notranslate"><span class="pre">print(type(1))</span></code>を実行すると<code class="docutils literal notranslate"><span class="pre">&lt;class</span> <span class="pre">'int'&gt;</span></code>と表示され、クラス名も<code class="docutils literal notranslate"><span class="pre">int</span></code>であることが分かる。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Index:</span> <span class="pre">10</span> <span class="pre">entries,</span> <span class="pre">Chine</span> <span class="pre">to</span> <span class="pre">UK</span></code></p>
<ul>
<li><p>行のインデックスの情報</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Chine</span></code>から<code class="docutils literal notranslate"><span class="pre">UK</span></code>までの<code class="docutils literal notranslate"><span class="pre">10</span></code>個のデータ</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">columns</span> <span class="pre">(total</span> <span class="pre">5</span> <span class="pre">columns):</span></code></p>
<ul>
<li><p>列の数（5つ）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span>&#160; <span class="pre">10</span> <span class="pre">non-null</span> <span class="pre">int64</span></code></p>
<ul>
<li><p>列インデックスは<code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10</span></code>の非欠損値のデータ（<code class="docutils literal notranslate"><span class="pre">non-null</span></code>とは非欠損値を意味）があり，欠損値なし（行数が<code class="docutils literal notranslate"><span class="pre">10</span></code>であり、<code class="docutils literal notranslate"><span class="pre">10</span></code>の非欠損値であるため，即ち，欠損値数は<code class="docutils literal notranslate"><span class="pre">11-11=0</span></code>）</p></li>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">int64</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span>&#160; <span class="pre">9</span> <span class="pre">non-null</span> <span class="pre">float64</span></code></p>
<ul>
<li><p>列インデックスは<code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p>9の非欠損値データがあり，欠損値数は<code class="docutils literal notranslate"><span class="pre">1＝10-9</span></code></p></li>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">float64</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">inv</span>&#160; <span class="pre">8</span> <span class="pre">non-null</span> <span class="pre">float64</span></code></p>
<ul>
<li><p>列インデックスは<code class="docutils literal notranslate"><span class="pre">2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">8</span></code>の非欠損値データがあり，欠損値数は<code class="docutils literal notranslate"><span class="pre">2＝10-8</span></code></p></li>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">float64</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">pop</span>&#160; <span class="pre">10</span> <span class="pre">non-null</span> <span class="pre">int64</span></code></p>
<ul>
<li><p>列インデックスは<code class="docutils literal notranslate"><span class="pre">3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10</span></code>の非欠損値データがあり，欠損値数なし<code class="docutils literal notranslate"><span class="pre">0＝10-10</span></code></p></li>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">int64</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">continent</span>&#160;&#160; <span class="pre">10</span> <span class="pre">non-null</span> <span class="pre">object</span></code></p>
<ul>
<li><p>列インデックスは<code class="docutils literal notranslate"><span class="pre">4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10</span></code>の非欠損値データがあり，欠損値数なし<code class="docutils literal notranslate"><span class="pre">0＝10-10</span></code></p></li>
<li><p>データ型は<code class="docutils literal notranslate"><span class="pre">object</span></code>（文字列などのデータ型）</p></li>
<li><p>（注意）整数型や浮動小数点型に文字列が混ざっている場合にも列のデータ型は<code class="docutils literal notranslate"><span class="pre">object</span></code>になる</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dtypes:</span> <span class="pre">float64(2),</span> <span class="pre">int64(2),</span> <span class="pre">object(1)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の列にどのようなのデータ型があるかを示す</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">float64</span></code>と<code class="docutils literal notranslate"><span class="pre">int64</span></code>が2列つずつ，文字列は１列</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">usage:</span> <span class="pre">480.0+</span> <span class="pre">bytes</span></code></p>
<ul>
<li><p>メモリー使用量は約<code class="docutils literal notranslate"><span class="pre">480.0</span></code>バイト</p></li>
</ul>
</li>
</ul>
<p>データを読み込んだら必ず<code class="docutils literal notranslate"><span class="pre">info()</span></code>を使って欠損値の数や列のデータ型を確認するようにしよう。</p>
<p>また，データの統計的な特徴は次の<code class="docutils literal notranslate"><span class="pre">.describe()</span></code>メソッドでチェックできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>10.000000</td>
      <td>9.000000</td>
      <td>8.000000</td>
      <td>10.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5070.700000</td>
      <td>2605.222222</td>
      <td>2009.625000</td>
      <td>328.800000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5817.610106</td>
      <td>2579.061107</td>
      <td>2959.228564</td>
      <td>565.729578</td>
    </tr>
    <tr>
      <th>min</th>
      <td>477.000000</td>
      <td>176.000000</td>
      <td>135.000000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2233.500000</td>
      <td>942.000000</td>
      <td>682.250000</td>
      <td>53.500000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2972.000000</td>
      <td>1598.000000</td>
      <td>888.500000</td>
      <td>67.500000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4842.500000</td>
      <td>2675.000000</td>
      <td>1546.250000</td>
      <td>116.250000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>20118.000000</td>
      <td>7796.000000</td>
      <td>9137.000000</td>
      <td>1434.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">count</span></code>：観測値の数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean</span></code>：平均</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std</span></code>：標準偏差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code>：最小値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code>：最大値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">25%</span></code>：第１四分位数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">50%</span></code>：第２四分位数（中央値）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">75%</span></code>：第３四分位数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code>：最大値</p></li>
</ul>
<p>次のデータ属性<code class="docutils literal notranslate"><span class="pre">.shape</span></code>を使って<code class="docutils literal notranslate"><span class="pre">df</span></code>の行と列の長さを確認することができる。返値はタプルで，<code class="docutils literal notranslate"><span class="pre">(行の数，列の数)</span></code>と解釈する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10, 5)
</pre></div>
</div>
</div>
</div>
<p>返値はタプルなので，行数は以下で取得できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">len()</span></code>関数を使って行数を示すこともできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataframe">
<h2><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の構成要素<a class="headerlink" href="#dataframe" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には様々な属性があるが、次の３点について説明する。</p>
<ul class="simple">
<li><p>データ：<code class="docutils literal notranslate"><span class="pre">df.to_numpy()</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">df.values</span></code>で抽出できる。</p></li>
<li><p>列ラベル：<code class="docutils literal notranslate"><span class="pre">df.columns</span></code>で抽出できる。</p></li>
<li><p>行ラベル：<code class="docutils literal notranslate"><span class="pre">df.index</span></code>で抽出できる。</p></li>
</ul>
<p>まずデータ自体を抽出してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[20118, 7796.0, 9137.0, 1434, &#39;Asia&#39;],
       [2950, 1598.0, 806.0, 67, &#39;Europe&#39;],
       [4274, 2294.0, 971.0, 84, &#39;Europe&#39;],
       [9142, 5936.0, 2471.0, 1366, &#39;Asia&#39;],
       [2463, 1423.0, 614.0, 61, &#39;Europe&#39;],
       [5032, 2675.0, 1238.0, 127, &#39;Asia&#39;],
       [2157, 942.0, 705.0, 51, &#39;Asia&#39;],
       [477, 176.0, 135.0, 6, &#39;Asia&#39;],
       [1100, 607.0, nan, 24, &#39;Asia&#39;],
       [2994, nan, nan, 68, &#39;Europe&#39;]], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy.ndarray
</pre></div>
</div>
</div>
</div>
<p>これで分かることは，メインのデータの部分は<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>の<code class="docutils literal notranslate"><span class="pre">ndarray</span></code>（<code class="docutils literal notranslate"><span class="pre">n</span></code>次元<code class="docutils literal notranslate"><span class="pre">array</span></code>）であることだ。即ち，<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>は<code class="docutils literal notranslate"><span class="pre">NumPy</span></code>に基づいて構築されており，データ値の計算などは<code class="docutils literal notranslate"><span class="pre">array</span></code>が裏で動いているということである。<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>は行と列のラベルを追加し，より直感的に使えるように拡張しているのである。</p>
<p>次に列ラベルを取り出してみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;gdp&#39;, &#39;con&#39;, &#39;inv&#39;, &#39;pop&#39;, &#39;continent&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dtype='object'</span></code>から列ラベルに使われているデータ型（<code class="docutils literal notranslate"><span class="pre">dtype</span></code>）はオブジェクト型（<code class="docutils literal notranslate"><span class="pre">object</span></code>）だとわかる。</p>
<ul class="simple">
<li><p>上でも簡単に説明したが、オブジェクト型とは文字型を含む「その他」のデータ型と理解すれば良いだろう。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.columns</span></code>の戻り値にある<code class="docutils literal notranslate"><span class="pre">dtype='object'</span></code>と<code class="docutils literal notranslate"><span class="pre">df.to_numpy()</span></code>の戻り値にある<code class="docutils literal notranslate"><span class="pre">dtype=object</span></code>は同じ意味。</p></li>
</ul>
<p>列ラベル自体のデータ型（もしくは、クラス名）は次のコードで調べることができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.base.Index
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dir()</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">py4macro.see()</span></code>で調べると多くのメソッドや属性が確認できるが，その中に<code class="docutils literal notranslate"><span class="pre">.tolist()</span></code>が含まれており，これを使うことにより列ラベルをリストに変換することができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;gdp&#39;, &#39;con&#39;, &#39;inv&#39;, &#39;pop&#39;, &#39;continent&#39;]
</pre></div>
</div>
</div>
</div>
<p>行ラベルについても同じことができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;China&#39;, &#39;France&#39;, &#39;Germany&#39;, &#39;India&#39;, &#39;Italy&#39;, &#39;Japan&#39;, &#39;Korea&#39;,
       &#39;Singapore&#39;, &#39;Taiwan&#39;, &#39;UK&#39;],
      dtype=&#39;object&#39;, name=&#39;country&#39;)
</pre></div>
</div>
</div>
</div>
<p>行ラベルの各要素のデータ型<code class="docutils literal notranslate"><span class="pre">object</span></code>は文字列を意味している。列<code class="docutils literal notranslate"><span class="pre">country</span></code>を行ラベルに指定したが，行ラベル名を削除したので<code class="docutils literal notranslate"><span class="pre">name=''</span></code>となっている。行ラベル自体（もしくは全体）のデータ型（クラス名）は</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.base.Index
</pre></div>
</div>
</div>
</div>
<p>であり，ラベルをリストとして抽出することもできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">df_index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;China&#39;,
 &#39;France&#39;,
 &#39;Germany&#39;,
 &#39;India&#39;,
 &#39;Italy&#39;,
 &#39;Japan&#39;,
 &#39;Korea&#39;,
 &#39;Singapore&#39;,
 &#39;Taiwan&#39;,
 &#39;UK&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h2>要素の抽出<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<section id="id4">
<h3>説明<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">NumPy</span></code>の<code class="docutils literal notranslate"><span class="pre">array</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">[,]</span></code>を使い要素を抽出した。<code class="docutils literal notranslate"><span class="pre">Pandas</span></code>の場合，様々な抽出方法があるが，覚えやすく少しでも間違いの可能性を減らすために，そして可読性向上のために<code class="docutils literal notranslate"><span class="pre">array</span></code>に対応する以下の２つの方法を使うことにする。</p>
<ul class="simple">
<li><p>ラベルを使う方法：<code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code></p></li>
<li><p>インデックスを使う方法：<code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>（これは<code class="docutils literal notranslate"><span class="pre">array</span></code>の<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>と同じと考えて良い）</p></li>
</ul>
<p>１つ目の<code class="docutils literal notranslate"><span class="pre">loc</span></code>はラベルのlocationと覚えよう。２つ目はの<code class="docutils literal notranslate"><span class="pre">iloc</span></code>の<code class="docutils literal notranslate"><span class="pre">i</span></code>はインデックス（index）の<code class="docutils literal notranslate"><span class="pre">i</span></code>であり，index locationという意味である。使い方は<code class="docutils literal notranslate"><span class="pre">array</span></code>の場合と基本的に同じである。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code>の左は行，右は列を表す。</p></li>
<li><p>行または列を連続して選択する（slicing）場合は<code class="docutils literal notranslate"><span class="pre">:</span></code>を使う。（<code class="docutils literal notranslate"><span class="pre">start:end</span></code>）</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code>の左右を省略する場合は，「全て」という意味になる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code>の左を省略すると「最初から」という意味になる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:</span></code>の右を省略すると「最後まで」という意味になる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>を含む。（要注意！）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>は含まず，その１つ前のインデックスまでが含まれる。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code>の右に書く<code class="docutils literal notranslate"><span class="pre">:</span></code>は省略可能であるが省略しないことを推奨する。</p></li>
</ul>
<p>「特例」として<code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>と<code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>以外に</p>
<ul class="simple">
<li><p>ラベルと<code class="docutils literal notranslate"><span class="pre">[]</span></code>だけを使い<strong>列</strong>を選択する方法</p></li>
</ul>
<p>も説明する。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>を含む。（要注意！）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.iloc[,]</span></code>の場合，<code class="docutils literal notranslate"><span class="pre">end</span></code>は含まず，その１つ前のインデックスまでが含まれる。</p></li>
</ul>
</div>
</section>
<section id="loc">
<h3><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>（ラベル使用）<a class="headerlink" href="#loc" title="Link to this heading">#</a></h3>
<p><strong>１つの行を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Japan&#39;</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp            5032
con          2675.0
inv          1238.0
pop             127
continent      Asia
Name: Japan, dtype: object
</pre></div>
</div>
</div>
</div>
<p><strong>１つの行を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;Japan&#39;</span><span class="p">],:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>と<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>を比べると、表示が異なることが分かると思う。コードには次の違いがある。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>で抽出する場合、<code class="docutils literal notranslate"><span class="pre">:</span></code>の左側に<code class="docutils literal notranslate"><span class="pre">[]</span></code>を使う。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code>で抽出する場合、<code class="docutils literal notranslate"><span class="pre">:</span></code>の左側に<code class="docutils literal notranslate"><span class="pre">[]</span></code>を使わない。</p></li>
</ul>
<p><strong>複数行を抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;Japan&#39;</span><span class="p">,</span> <span class="s1">&#39;UK&#39;</span><span class="p">],:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>上のコードでは、<code class="docutils literal notranslate"><span class="pre">:</span></code>の左側にリストが使われている。次のコードでも同じ結果となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Japan&#39;</span><span class="p">,</span> <span class="s1">&#39;UK&#39;</span><span class="p">]</span>  <span class="c1">#1</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rows</span><span class="p">,:]</span>          <span class="c1">#2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">#1</span></code>の<code class="docutils literal notranslate"><span class="pre">rows</span></code>はリストであり、<code class="docutils literal notranslate"><span class="pre">#2</span></code>の<code class="docutils literal notranslate"><span class="pre">:</span></code>の左側にリストが使われていることが分かる。</p>
<p><strong>複数行を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;France&#39;</span><span class="p">:</span><span class="s1">&#39;Japan&#39;</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>スライシングの場合、<code class="docutils literal notranslate"><span class="pre">:</span></code>の左右に<code class="docutils literal notranslate"><span class="pre">[]</span></code>は使わない。</p>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
China        20118
France        2950
Germany       4274
India         9142
Italy         2463
Japan         5032
Korea         2157
Singapore      477
Taiwan        1100
UK            2994
Name: gdp, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>で抽出するので、<code class="docutils literal notranslate"><span class="pre">:</span></code>の右に<code class="docutils literal notranslate"><span class="pre">[]</span></code>は使わない。</p>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出するために、<code class="docutils literal notranslate"><span class="pre">:</span></code>の右に<code class="docutils literal notranslate"><span class="pre">[]</span></code>を使っている。</p>
<p><strong>複数列を抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>1434</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>67</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>84</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>1366</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>61</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>127</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>51</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>6</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>24</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>次のようにしても同じ結果となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">cols</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>1434</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>67</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>84</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>1366</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>61</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>127</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>51</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>6</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>24</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数列を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
    </tr>
    <tr>
      <th>France</th>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
    </tr>
    <tr>
      <th>India</th>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="iloc">
<span id="sec-3-iloc"></span><h3><code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>（インデックス使用）<a class="headerlink" href="#iloc" title="Link to this heading">#</a></h3>
<p><strong>１つの行を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp            5032
con          2675.0
inv          1238.0
pop             127
continent      Asia
Name: Japan, dtype: object
</pre></div>
</div>
</div>
</div>
<p><strong>１つの行を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">5</span><span class="p">],:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数行を抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数行を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
China        7796.0
France       1598.0
Germany      2294.0
India        5936.0
Italy        1423.0
Japan        2675.0
Korea         942.0
Singapore     176.0
Taiwan        607.0
UK              NaN
Name: con, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>con</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>7796.0</td>
    </tr>
    <tr>
      <th>France</th>
      <td>1598.0</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>2294.0</td>
    </tr>
    <tr>
      <th>India</th>
      <td>5936.0</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>1423.0</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>2675.0</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>942.0</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>176.0</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>607.0</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数列を選択</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>con</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>7796.0</td>
      <td>1434</td>
    </tr>
    <tr>
      <th>France</th>
      <td>1598.0</td>
      <td>67</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>2294.0</td>
      <td>84</td>
    </tr>
    <tr>
      <th>India</th>
      <td>5936.0</td>
      <td>1366</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>1423.0</td>
      <td>61</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>2675.0</td>
      <td>127</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>942.0</td>
      <td>51</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>176.0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>607.0</td>
      <td>24</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>NaN</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>次のコードでも同じ結果となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">cols</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>con</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>7796.0</td>
      <td>1434</td>
    </tr>
    <tr>
      <th>France</th>
      <td>1598.0</td>
      <td>67</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>2294.0</td>
      <td>84</td>
    </tr>
    <tr>
      <th>India</th>
      <td>5936.0</td>
      <td>1366</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>1423.0</td>
      <td>61</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>2675.0</td>
      <td>127</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>942.0</td>
      <td>51</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>176.0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>607.0</td>
      <td>24</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>NaN</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>複数列を連続抽出（slicing）</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>con</th>
      <th>inv</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>7796.0</td>
      <td>9137.0</td>
    </tr>
    <tr>
      <th>France</th>
      <td>1598.0</td>
      <td>806.0</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>2294.0</td>
      <td>971.0</td>
    </tr>
    <tr>
      <th>India</th>
      <td>5936.0</td>
      <td>2471.0</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>1423.0</td>
      <td>614.0</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>2675.0</td>
      <td>1238.0</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>942.0</td>
      <td>705.0</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>176.0</td>
      <td>135.0</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>607.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id5">
<h3><code class="docutils literal notranslate"><span class="pre">[]</span></code>で列の選択（ラベル使用）<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
China        20118
France        2950
Germany       4274
India         9142
Italy         2463
Japan         5032
Korea         2157
Singapore      477
Taiwan        1100
UK            2994
Name: gdp, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>１つの列を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>上の２つのコードの違いに注意しよう。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>で抽出する場合、角括弧が二重になっている。即ち、<code class="docutils literal notranslate"><span class="pre">[[]]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code>で抽出する場合、角括弧が二重になっていない。即ち、<code class="docutils literal notranslate"><span class="pre">[]</span></code></p></li>
</ul>
<p>次の様に考えよう。<code class="docutils literal notranslate"><span class="pre">[]</span></code>を使って列を抽出する場合、</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[]</span></code>の中にラベル名をそのまま書くと<code class="docutils literal notranslate"><span class="pre">Series</span></code>として抽出される。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[]</span></code>の中にラベル名を<strong>リスト</strong>として書くと<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として抽出される。</p></li>
</ul>
<p><strong>複数列を選択</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>pop</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>1434</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>67</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>84</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>1366</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>61</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>127</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>51</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>6</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>24</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>68</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="id6">
<h2>ある条件の下で行の抽出<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<section id="id7">
<h3>１つの条件の場合<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<section id="gdp1200">
<h4>例１：GDPが1200未満の行の抽出<a class="headerlink" href="#gdp1200" title="Link to this heading">#</a></h4>
<p>まず条件を作る。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1200</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
China        False
France       False
Germany      False
India        False
Italy        False
Japan        False
Korea        False
Singapore     True
Taiwan        True
UK           False
Name: gdp, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>この条件では，GDPが100未満の行は<code class="docutils literal notranslate"><span class="pre">True</span></code>，以上の行は<code class="docutils literal notranslate"><span class="pre">False</span></code>となる。この条件を<code class="docutils literal notranslate"><span class="pre">cond</span></code>というの変数に割り当てる。<code class="docutils literal notranslate"><span class="pre">()</span></code>を省いても良いが，ある方が分かりやすいだろう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cond</span></code>を<code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>の引数とすることにより，<code class="docutils literal notranslate"><span class="pre">True</span></code>の行だけを抽出できる。（注意：<code class="docutils literal notranslate"><span class="pre">cond</span></code>を使って<strong>行</strong>を抽出しようとしているので<code class="docutils literal notranslate"><span class="pre">,</span></code>の左側に書く。）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>この条件の下で<code class="docutils literal notranslate"><span class="pre">inv</span></code>だけを抽出したい場合</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[cond,'inv']</span></code></p></li>
</ul>
<p>とする。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>以下のように抽出を連続ですることも可能だが，避けるように！</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[cond,:]['inv']</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[cond,:].loc[:,'inv']</span></code></p></li>
</ul>
</div>
</section>
<section id="continentasia">
<h4>例２：<code class="docutils literal notranslate"><span class="pre">continent</span></code>が<code class="docutils literal notranslate"><span class="pre">Asia</span></code>の行を抽出<a class="headerlink" href="#continentasia" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Asia&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="id8">
<h3>複数条件の場合<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<section id="id9">
<h4>例３<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<p>以下の条件の<strong>両方</strong>が満たされる場合：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>が<code class="docutils literal notranslate"><span class="pre">5000</span></code>以上</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inv</span></code>が<code class="docutils literal notranslate"><span class="pre">2000</span></code>以下</p></li>
</ul>
<p>それぞれの条件を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;inv&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>２つの条件が同時に満たされる条件を作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>＜注意＞</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;</span></code>を使っている。理由は，<code class="docutils literal notranslate"><span class="pre">cond1</span></code>と<code class="docutils literal notranslate"><span class="pre">cond2</span></code>のそれぞれの行の要素を比較して真偽値から構成される<code class="docutils literal notranslate"><span class="pre">Series</span></code>を返すためである。従って，一つの値をもう一つの値と比べて真偽値を計算する<code class="docutils literal notranslate"><span class="pre">and</span></code>を使うとエラーが発生する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>や<code class="docutils literal notranslate"><span class="pre">Series</span></code>で<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>を使う場合は，比較コードを<code class="docutils literal notranslate"><span class="pre">()</span></code>の中に入れることを推奨する。<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>は優先されて計算されるためである。（上の例では問題は発生しなし。）</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">cond</span></code>を引数に使い行を抽出する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id10">
<h4>例４<a class="headerlink" href="#id10" title="Link to this heading">#</a></h4>
<p>以下の条件の<strong>どちらか</strong>が満たされる場合：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>は<code class="docutils literal notranslate"><span class="pre">5000</span></code>以上</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span></code>は<code class="docutils literal notranslate"><span class="pre">2000</span></code>以下</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">cond</span> <span class="o">=</span> <span class="p">(</span><span class="n">cond1</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>＜注意＞</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code>を使っている。理由は，<code class="docutils literal notranslate"><span class="pre">cond1</span></code>と<code class="docutils literal notranslate"><span class="pre">cond2</span></code>のそれぞれの行の要素を比較して真偽値から構成される<code class="docutils literal notranslate"><span class="pre">Series</span></code>を返すためである。従って，一つの値をもう一つの値と比べて真偽値を計算する<code class="docutils literal notranslate"><span class="pre">or</span></code>を使うとエラーが発生する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>や<code class="docutils literal notranslate"><span class="pre">Series</span></code>で<code class="docutils literal notranslate"><span class="pre">|</span></code>を使う場合は，比較コードを<code class="docutils literal notranslate"><span class="pre">()</span></code>の中に入れることを推奨する。<code class="docutils literal notranslate"><span class="pre">|</span></code>は優先されて計算されるためである。（上の例では問題は発生しなし。）</p></li>
</ul>
<p>＜コメント＞</p>
<ul class="simple">
<li><p>上の例では，<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>が<code class="docutils literal notranslate"><span class="pre">and</span></code>，<code class="docutils literal notranslate"><span class="pre">|</span></code>が<code class="docutils literal notranslate"><span class="pre">or</span></code>の役割を果たしている。同様に<code class="docutils literal notranslate"><span class="pre">~</span></code>が<code class="docutils literal notranslate"><span class="pre">not</span></code>（真偽値の反転）の代わりに使われる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>や<code class="docutils literal notranslate"><span class="pre">Series</span></code>で<code class="docutils literal notranslate"><span class="pre">~</span></code>を使う場合は，コードを<code class="docutils literal notranslate"><span class="pre">()</span></code>の中に入れることを推奨する。<code class="docutils literal notranslate"><span class="pre">~</span></code>は優先されて計算されるためである。</p></li>
</ul>
</section>
<section id="id11">
<h4>例５<a class="headerlink" href="#id11" title="Link to this heading">#</a></h4>
<p>以下の条件の<strong>どちらか</strong>が満たされ</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>は<code class="docutils literal notranslate"><span class="pre">5000</span></code>以上</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span></code>は<code class="docutils literal notranslate"><span class="pre">2000</span></code>以下</p></li>
</ul>
<p>かつ以下の条件も<strong>同時に</strong>満たされる場合：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">continent</span></code>が<code class="docutils literal notranslate"><span class="pre">Asia</span></code>と等しい</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">cond2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">cond3</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Asia&#39;</span><span class="p">)</span>
<span class="n">cond</span> <span class="o">=</span> <span class="p">((</span><span class="n">cond1</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">cond3</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="query">
<h3><code class="docutils literal notranslate"><span class="pre">query()</span></code><a class="headerlink" href="#query" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">query()</span></code>というメソッドを使うと、文字列を使い行の抽出コードを書くことができる。これにより直感的なコード書くことが可能となる。</p>
<section id="id12">
<h4>例１の場合：<a class="headerlink" href="#id12" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;gdp &lt; 1200&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id13">
<h4>例２の場合<a class="headerlink" href="#id13" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;continent == &quot;Asia&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id14">
<h4>例３の場合<a class="headerlink" href="#id14" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(gdp &gt;= 5000) &amp; (inv &lt;= 2000)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id15">
<h4>例４の場合<a class="headerlink" href="#id15" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(gdp &gt;= 5000) | (con &lt;= 2000)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id16">
<h4>例５の場合<a class="headerlink" href="#id16" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;(gdp &gt;= 5000 | con &lt;= 2000) &amp; (continent == &quot;Asia&quot;)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>にない変数で条件を設定する場合<code class="docutils literal notranslate"><span class="pre">&#64;</span></code>が必要になる。例えば，変数<code class="docutils literal notranslate"><span class="pre">z</span></code>という変数があるとしよう。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>変数<code class="docutils literal notranslate"><span class="pre">z</span></code>の値に基づいて行の抽出をする場合は次のようにする。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;gdp &lt; @z&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Singapore</th>
      <td>477</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></span></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>数字で始まる列ラベルに<code class="docutils literal notranslate"><span class="pre">.query()</span></code>を使うとエラーが発生するため，列ラベルを変更する必要がある。列ラベルを変更できない場合は異なる方法を使うように。</p>
</div>
</section>
</section>
</section>
<section id="id17">
<h2>列と行の追加と削除<a class="headerlink" href="#id17" title="Link to this heading">#</a></h2>
<section id="id18">
<h3>列の追加 <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code><a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">[]</span></code>に列ラベルを使って列を抽出することができるが，<code class="docutils literal notranslate"><span class="pre">[]</span></code>は列の追加にも使えるので，ここではその使い方を説明する。まず，全ての行が<code class="docutils literal notranslate"><span class="pre">1.0</span></code>となる列を作成するとしよう。その場合，以下のようにする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
      <th>Intercept</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>次の例では既存の列から新たな列を作成する。まず１人当たりGDPの計算を計算し，それを変数<code class="docutils literal notranslate"><span class="pre">gdp_pc</span></code>に割り当てる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdp_pc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>

<span class="n">gdp_pc</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
China      14.029289
France     44.029851
Germany    50.880952
India       6.692533
Italy      40.377049
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>これは<code class="docutils literal notranslate"><span class="pre">Series</span></code>であり，<code class="docutils literal notranslate"><span class="pre">gdp_pc</span></code>として<code class="docutils literal notranslate"><span class="pre">df</span></code>に追加する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdp_pc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdp_pc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
      <th>Intercept</th>
      <th>gdp_pc</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
      <td>1.0</td>
      <td>14.029289</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
      <td>1.0</td>
      <td>44.029851</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id19">
<h3>列の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code><a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.loc[]</span></code>は行と列の抽出に使ったが，追加にも使える。<code class="docutils literal notranslate"><span class="pre">[]</span></code>と同じと考えれば良いだろう。次の例では<code class="docutils literal notranslate"><span class="pre">pop</span></code>を2倍した列を追加している。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;2pop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
      <th>Intercept</th>
      <th>gdp_pc</th>
      <th>2pop</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
      <td>1.0</td>
      <td>14.029289</td>
      <td>2868</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
      <td>1.0</td>
      <td>44.029851</td>
      <td>134</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84</td>
      <td>Europe</td>
      <td>1.0</td>
      <td>50.880952</td>
      <td>168</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="del">
<h3>列の削除 <code class="docutils literal notranslate"><span class="pre">del</span></code><a class="headerlink" href="#del" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;2pop&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>ここで<code class="docutils literal notranslate"><span class="pre">del</span></code>はdeleteの略。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
      <th>Intercept</th>
      <th>gdp_pc</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
      <td>1.0</td>
      <td>14.029289</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
      <td>1.0</td>
      <td>44.029851</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>列<code class="docutils literal notranslate"><span class="pre">2pop</span></code>が削除されている。</p>
</section>
<section id="drop">
<h3>列の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code><a class="headerlink" href="#drop" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には<code class="docutils literal notranslate"><span class="pre">.drop()</span></code>というメソッドが用意されているので，それを使うことも可能である。</p>
<p>下のコードの説明：</p>
<ul class="simple">
<li><p>引数</p>
<ul>
<li><p>第１引数（位置引数）：削除する列ラベルのリスト（一つの列のみを指定する場合はリストではなく、そのまま列ラベルを書いても可）</p></li>
<li><p>第２引数（キーワード引数）：<code class="docutils literal notranslate"><span class="pre">axis=columns</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>（<code class="docutils literal notranslate"><span class="pre">1</span></code>は列を表しし、<code class="docutils literal notranslate"><span class="pre">0</span></code>は行を表す）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.drop()</span></code>はコピーを作るだけなので，元の<code class="docutils literal notranslate"><span class="pre">df</span></code>を上書きしたい場合は次のどちらかが必要となる。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>に再割り当てする。</p></li>
<li><p>オプション<code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">False</span></code>）を追加する。</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Intercept&#39;</span><span class="p">,</span><span class="s1">&#39;gdp_pc&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

<span class="c1"># df.drop(&#39;Intercept&#39;, axis=&#39;columns&#39;, inplace=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id20">
<h3>行の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code><a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>はh行と列の抽出，そして列の追加に使ったが，行の追加にも使える。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20566</span><span class="p">,</span> <span class="mi">14462</span><span class="p">,</span> <span class="mi">4557</span><span class="p">,</span> <span class="mi">329</span><span class="p">,</span> <span class="s1">&#39;North America&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Taiwan</th>
      <td>1100.0</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>US</th>
      <td>20566.0</td>
      <td>14462.0</td>
      <td>4557.0</td>
      <td>329.0</td>
      <td>North America</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>上の例では，最初の4つの要素は整数として入力されたが，<code class="docutils literal notranslate"><span class="pre">df</span></code>の中では浮動小数点に変換されている。</p>
</section>
<section id="id21">
<h3>行の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code><a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.drop()</span></code>は列を削除する際に紹介したが、行の削除にも使えるメソッドである。</p>
<ul class="simple">
<li><p>引数</p>
<ul>
<li><p>第１引数（位置引数）：削除する行ラベルのリスト（一つの行のみを指定する場合はリストではなく、そのまま行ラベルを書いても可）</p></li>
<li><p>第２引数（キーワード引数）：<code class="docutils literal notranslate"><span class="pre">axis=rows</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">axis=0</span></code>（<code class="docutils literal notranslate"><span class="pre">1</span></code>は列を表しし、<code class="docutils literal notranslate"><span class="pre">0</span></code>は行を表す）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.drop()</span></code>はコピーを作るだけなので，元の<code class="docutils literal notranslate"><span class="pre">df</span></code>を上書きしたい場合は次のどちらかが必要となる。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>に再割り当てする。</p></li>
<li><p>オプション<code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>（デフォルトは<code class="docutils literal notranslate"><span class="pre">False</span></code>）を追加する。</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span>

<span class="c1"># df.drop(&#39;US&#39;, axis=0, inplace=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Japan</th>
      <td>5032.0</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157.0</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477.0</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100.0</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">US</span></code>の行が削除されている。</p>
</section>
</section>
<section id="id22">
<h2>欠損値の扱い<a class="headerlink" href="#id22" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code>では欠損値は<code class="docutils literal notranslate"><span class="pre">NaN</span></code>（Not a Number）や<code class="docutils literal notranslate"><span class="pre">&lt;NA&gt;</span></code>（Not Availabel）と表示されるが，<code class="docutils literal notranslate"><span class="pre">null</span></code>と呼んだりもする。</p>
<section id="id23">
<h3>欠損値の確認<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<p>欠損値があるかどうかの確認は，<code class="docutils literal notranslate"><span class="pre">df.info()</span></code>でもできるが，以下のメソッドを組み合わせることでも可能である。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">isna()</span></code>：（is it na?の略）それぞれの要素について<code class="docutils literal notranslate"><span class="pre">NaN</span></code>の場合<code class="docutils literal notranslate"><span class="pre">True</span></code>を，そうでない場合は<code class="docutils literal notranslate"><span class="pre">False</span></code>を返す。（<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の全ての要素が<code class="docutils literal notranslate"><span class="pre">True/False</span></code>となる。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code>：<code class="docutils literal notranslate"><span class="pre">df</span></code>の上から下に<strong>行</strong>（rows）を縦断して，それぞれの列の中にある<code class="docutils literal notranslate"><span class="pre">True</span></code>数える。</p>
<ul>
<li><p>デフォルトで引数<code class="docutils literal notranslate"><span class="pre">axis='rows'</span></code>が指定されている。</p></li>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">rows</span></code>は複数！（<code class="docutils literal notranslate"><span class="pre">0</span></code>でも可）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum(axis='columns')</span></code>：<code class="docutils literal notranslate"><span class="pre">df</span></code>の左から右に<strong>列</strong>（columns）を横断して，それぞれの行の中にある<code class="docutils literal notranslate"><span class="pre">True</span></code>を数える。</p>
<ul>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">columns</span></code>は複数！（<code class="docutils literal notranslate"><span class="pre">1</span></code>でも可）</p></li>
</ul>
</li>
</ul>
<p>（注意）<code class="docutils literal notranslate"><span class="pre">sum()</span></code>の<code class="docutils literal notranslate"><span class="pre">axis</span></code>は「行を縦断」か「列を横断」かを指定する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp          0
con          1
inv          2
pop          0
continent    0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">inv</span></code>と<code class="docutils literal notranslate"><span class="pre">con</span></code>に<code class="docutils literal notranslate"><span class="pre">NaN</span></code>があることがわかる。<code class="docutils literal notranslate"><span class="pre">axis='columns'</span></code>を設定すると<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行を確認できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
China        0
France       0
Germany      0
India        0
Italy        0
Japan        0
Korea        0
Singapore    0
Taiwan       1
UK           2
dtype: int64
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行だけを抽出したい場合がある。その場合はメソッド<code class="docutils literal notranslate"><span class="pre">any()</span></code>が役に立つ。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">any()</span></code>：<code class="docutils literal notranslate"><span class="pre">df</span></code>の上から下に行（<code class="docutils literal notranslate"><span class="pre">rows</span></code>）を縦断して，それぞれの列の中で一つ以上<code class="docutils literal notranslate"><span class="pre">True</span></code>がある場合には<code class="docutils literal notranslate"><span class="pre">True</span></code>を，一つもない場合は<code class="docutils literal notranslate"><span class="pre">False</span></code>を返す。</p>
<ul>
<li><p>デフォルトで引数<code class="docutils literal notranslate"><span class="pre">axis='rows'</span></code>が指定されている。</p></li>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">rows</span></code>は複数！（<code class="docutils literal notranslate"><span class="pre">0</span></code>でも可）</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">any(axis='columns')</span></code>：dfの左から右に列（<code class="docutils literal notranslate"><span class="pre">columns</span></code>）を横断して，それぞれの行の中で一つ以上<code class="docutils literal notranslate"><span class="pre">True</span></code>がある場合には<code class="docutils literal notranslate"><span class="pre">True</span></code>を，一つもない場合は<code class="docutils literal notranslate"><span class="pre">False</span></code>を返す。</p>
<ul>
<li><p>引数値<code class="docutils literal notranslate"><span class="pre">columns</span></code>は複数！（1でも可）</p></li>
</ul>
</li>
</ul>
<p>（注意）<code class="docutils literal notranslate"><span class="pre">any()</span></code>の<code class="docutils literal notranslate"><span class="pre">axis</span></code>は「行を縦断」か「列を横断」かを指定する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cond</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Taiwan</th>
      <td>1100.0</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>これで<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行だけを抽出できた。</p>
</section>
<section id="id24">
<h3>欠損値がある行の削除<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<p>欠損値がある全ての行を削除する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032.0</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157.0</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477.0</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6.0</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Taiwan</span></code>と<code class="docutils literal notranslate"><span class="pre">UK</span></code>が削除されている。</p>
<p>このメソッドは，欠損値を削除するとどうなるかを示すだけであり<code class="docutils literal notranslate"><span class="pre">df</span></code>自体は影響は受けない。<code class="docutils literal notranslate"><span class="pre">df</span></code>自体から<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行を削除する場合は<code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>のオプション（デフォルトでは<code class="docutils literal notranslate"><span class="pre">False</span></code>になっている）を加えて</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>とするか，削除後の<code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">df</span></code>自体に再割り当てする。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
<p>また，ある列で<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行のみを削除する場合は，引数<code class="docutils literal notranslate"><span class="pre">subset</span></code>を使う。
次のコードでは、<code class="docutils literal notranslate"><span class="pre">con</span></code>に<code class="docutils literal notranslate"><span class="pre">NaN</span></code>がある行のみを削除している。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032.0</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157.0</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477.0</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100.0</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>（注意）オプション<code class="docutils literal notranslate"><span class="pre">subset=</span></code>には削除する列が１つであっても、<code class="docutils literal notranslate"><span class="pre">[]</span></code>を使いリストとして指定する。</p>
</section>
</section>
<section id="id25">
<h2>並び替え<a class="headerlink" href="#id25" title="Link to this heading">#</a></h2>
<p>行の並び替えにはメソッド<code class="docutils literal notranslate"><span class="pre">.sort_values()</span></code>を使う。引数に列ラベルを指定することにより、その列を基準に行を昇順に並び替える。</p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">gdp</span></code>の昇順に並び替えてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;gdp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Singapore</th>
      <td>477.0</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100.0</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157.0</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>降順にする場合は、引数<code class="docutils literal notranslate"><span class="pre">ascending=False</span></code>を付け加える（デフォルトでは<code class="docutils literal notranslate"><span class="pre">ascending=True</span></code>となっている）。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032.0</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>複数の列を基準に並び替えする場合は、引数<code class="docutils literal notranslate"><span class="pre">ascending=</span></code>に真偽値をリストとして指定する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span><span class="s1">&#39;gdp&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Japan</th>
      <td>5032.0</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Korea</th>
      <td>2157.0</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Taiwan</th>
      <td>1100.0</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Singapore</th>
      <td>477.0</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>2994.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ここでは<code class="docutils literal notranslate"><span class="pre">continent</span></code>に従って先に並び替えられ，その後に<code class="docutils literal notranslate"><span class="pre">gdp</span></code>に従って並び替えられている。<code class="docutils literal notranslate"><span class="pre">ascending</span></code>は昇順（<code class="docutils literal notranslate"><span class="pre">True</span></code>）か降順（<code class="docutils literal notranslate"><span class="pre">False</span></code>）かを指定する引数であり，<code class="docutils literal notranslate"><span class="pre">['continent','gdp']</span></code>と<code class="docutils literal notranslate"><span class="pre">ascending=['True','False']</span></code>の順番が対応している。</p>
</section>
<section id="id26">
<h2>行番号と列ラベル<a class="headerlink" href="#id26" title="Link to this heading">#</a></h2>
<section id="id27">
<h3>行番号を振り直す<a class="headerlink" href="#id27" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="#sec-3-data"><span class="std std-ref">データの読み込みとデータのチェック</span></a>においてデータを読み込んだ後，直ぐに<code class="docutils literal notranslate"><span class="pre">.set_index('year')</span></code>を使い，列<code class="docutils literal notranslate"><span class="pre">year</span></code>を行ラベルに設定した。もちろん，必ずしもそうする必要はなく，行番号（<code class="docutils literal notranslate"><span class="pre">0</span></code>，<code class="docutils literal notranslate"><span class="pre">1</span></code>，<code class="docutils literal notranslate"><span class="pre">2</span></code>，…）のままで作業をおこなっても全く問題ない。また行ラベルを設定した後に，行インデックスに戻したい場合もあるだろう。その場合には，メソッド<code class="docutils literal notranslate"><span class="pre">.reset_index()</span></code>を使うと，行のインデックスを0,1,2,..と振り直すことができる。<code class="docutils literal notranslate"><span class="pre">df</span></code>を使うと次のようになる。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>China</td>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>France</td>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Germany</td>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3</th>
      <td>India</td>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Italy</td>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Japan</td>
      <td>5032.0</td>
      <td>2675.0</td>
      <td>1238.0</td>
      <td>127.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Korea</td>
      <td>2157.0</td>
      <td>942.0</td>
      <td>705.0</td>
      <td>51.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Singapore</td>
      <td>477.0</td>
      <td>176.0</td>
      <td>135.0</td>
      <td>6.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Taiwan</td>
      <td>1100.0</td>
      <td>607.0</td>
      <td>NaN</td>
      <td>24.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>9</th>
      <td>UK</td>
      <td>2994.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>68.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>行ラベルがなくなり、元の行ラベル名は削除していたので、列ラベルないまま新たな列として追加されている。列ラベルを追加したい場合は、以下で説明するが、次のようにすれば良い。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="s1">&#39;country&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>ここで<code class="docutils literal notranslate"><span class="pre">''</span></code>は空の文字列を示す。一方で、元の行ラベルを列として追加したくない場合もある。その場合、<code class="docutils literal notranslate"><span class="pre">reset_index()</span></code>に引数<code class="docutils literal notranslate"><span class="pre">drop=True</span></code>を加えると良い。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.reset_index()</span></code>は、変更した場合にどのように見えるかを表示しているだけなので、<code class="docutils literal notranslate"><span class="pre">df</span></code>自体を変更する場合は<code class="docutils literal notranslate"><span class="pre">df</span></code>に再割り当てする必要がある。</p>
</section>
<section id="id28">
<h3>列のラベルの変更<a class="headerlink" href="#id28" title="Link to this heading">#</a></h3>
<p>列ラベルを変更する場合は、メソッド<code class="docutils literal notranslate"><span class="pre">.rename()</span></code>を使うと良いだろう。引数は次の形で設定する。</p>
<div class="math notranslate nohighlight">
\[\text{.rename}\left(\text{columns=}辞書\right)\]</div>
<p>ここで「辞書」は次のルールで指定する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code>:元のラベル</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>：新しいラベル</p></li>
</ul>
<p>次のコードでは，<code class="docutils literal notranslate"><span class="pre">df</span></code>の<code class="docutils literal notranslate"><span class="pre">pop</span></code>を<code class="docutils literal notranslate"><span class="pre">pop_new</span></code>に，<code class="docutils literal notranslate"><span class="pre">id</span></code>を<code class="docutils literal notranslate"><span class="pre">continent_new</span></code>に変更している。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span><span class="s1">&#39;pop_new&#39;</span><span class="p">,</span><span class="s1">&#39;continent&#39;</span><span class="p">:</span><span class="s1">&#39;continent_new&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>pop_new</th>
      <th>continent_new</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>ただし，再割り当てしないと<code class="docutils literal notranslate"><span class="pre">df</span></code>は変更されないので注意しよう。即ち，上のコードでは<code class="docutils literal notranslate"><span class="pre">df</span></code>の行ラベルは変更されていない。</p>
<p><code class="docutils literal notranslate"><span class="pre">.rename()</span></code>以外にも次のように変更することも可能である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;inv&#39;</span><span class="p">,</span><span class="s1">&#39;con&#39;</span><span class="p">,</span><span class="s1">&#39;pop_new&#39;</span><span class="p">,</span><span class="s1">&#39;continent_new&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>このコードは</p>
<blockquote>
<div><p>右辺の文字列のリストを<code class="docutils literal notranslate"><span class="pre">df.columns</span></code>に割り当てる</p>
</div></blockquote>
<p>と読むことができる。このコードにより割り当てが完了し，<code class="docutils literal notranslate"><span class="pre">df</span></code>は変更されることになる。<code class="docutils literal notranslate"><span class="pre">df</span></code>を表示してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop_new</th>
      <th>continent_new</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>この方法が簡単そうだが、全ての列ラベルをリストとして準備する必要がある点である。列の数が多いと面倒なので，そういう場合は<code class="docutils literal notranslate"><span class="pre">.rename()</span></code>の方が使いやすいだろう。元の列ラベルに戻しておこう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;pop_new&#39;</span><span class="p">:</span><span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;continent_new&#39;</span><span class="p">:</span><span class="s1">&#39;continent&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id29">
<h2>よく使うメソッド<a class="headerlink" href="#id29" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には様々なメソッドが用意されており，ここでは頻繁に用いるメソッドを幾つか紹介するために日本の時系列データからなる<code class="docutils literal notranslate"><span class="pre">.csv</span></code>ファイルを読み込むことにする。<code class="docutils literal notranslate"><span class="pre">data2.csv</span></code>は<a class="reference external" href="https://raw.githubusercontent.com/Py4Basics/py4basics.github.io/source/data/data2.csv">ここをクリック</a>をマウスの右クリックすることによりダウンロードすることもできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/data2.csv&#39;</span><span class="p">)</span>
<span class="n">jp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>gov</th>
      <th>net_ex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2012</td>
      <td>517928.400</td>
      <td>295751.750</td>
      <td>98682.200</td>
      <td>127135.975</td>
      <td>-3941.775</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013</td>
      <td>528522.025</td>
      <td>303606.600</td>
      <td>100590.050</td>
      <td>129984.100</td>
      <td>-6006.850</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2014</td>
      <td>529656.425</td>
      <td>300593.375</td>
      <td>103200.725</td>
      <td>131434.275</td>
      <td>-5477.075</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015</td>
      <td>538098.750</td>
      <td>300107.925</td>
      <td>108697.000</td>
      <td>132249.450</td>
      <td>-2955.575</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016</td>
      <td>541964.600</td>
      <td>298675.925</td>
      <td>109195.975</td>
      <td>134433.625</td>
      <td>-340.550</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2017</td>
      <td>551205.775</td>
      <td>301894.650</td>
      <td>111970.275</td>
      <td>134762.325</td>
      <td>2800.425</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2018</td>
      <td>554349.275</td>
      <td>302496.325</td>
      <td>113151.350</td>
      <td>136011.050</td>
      <td>2901.725</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2019</td>
      <td>553019.775</td>
      <td>300927.225</td>
      <td>113488.750</td>
      <td>138450.375</td>
      <td>281.825</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2020</td>
      <td>527946.300</td>
      <td>285155.350</td>
      <td>104932.325</td>
      <td>142151.400</td>
      <td>-4601.625</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2021</td>
      <td>536811.775</td>
      <td>288895.200</td>
      <td>103434.900</td>
      <td>143454.975</td>
      <td>1222.325</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>数値は日本の四半期データを年平均（単位：<code class="docutils literal notranslate"><span class="pre">10</span></code>億円）にしている。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">year</span></code>：年</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gdp</span></code>：国内総生産（Gross Domestic Product）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">con</span></code>：消費（consumption）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inv</span></code>：投資（investment）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gov</span></code>：政府支出（government expenditure）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">net_ex</span></code>：純輸出（net exports）</p></li>
</ul>
<p>列<code class="docutils literal notranslate"><span class="pre">year</span></code>を行ラベルに設定して説明を進めていくことにする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span> <span class="o">=</span> <span class="n">jp</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
<span class="n">jp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>gov</th>
      <th>net_ex</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012</th>
      <td>517928.400</td>
      <td>295751.75</td>
      <td>98682.20</td>
      <td>127135.975</td>
      <td>-3941.775</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>528522.025</td>
      <td>303606.60</td>
      <td>100590.05</td>
      <td>129984.100</td>
      <td>-6006.850</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="id30">
<h3>統計関連のメソッド<a class="headerlink" href="#id30" title="Link to this heading">#</a></h3>
<p><strong>＜以下で説明する統計関連のメソッドに関する注意点＞</strong><br></p>
<ul class="simple">
<li><p>計算して意味のある列のみを選択すること。<code class="docutils literal notranslate"><span class="pre">pandas</span></code>のバージョンにもよるが、文字列型の列を計算に含めるとエラーが発生する。<code class="docutils literal notranslate"><span class="pre">jp</span></code>は全てが浮動小数点となるため、以下では全ての列について計算を行なう。</p></li>
<li><p>数値に含まれる欠損値は無視されることになる。</p></li>
</ul>
<p>上でも出てきたが<code class="docutils literal notranslate"><span class="pre">.sum()</span></code>は各列の合計を返す（<code class="docutils literal notranslate"><span class="pre">axis='rows'</span></code>がデフォルト）。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp       5379503.100
con       2978104.325
inv       1067343.550
gov       1350067.550
net_ex     -16117.150
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>各行の合計を計算したい場合は引数<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">axis='columns'</span></code>を指定する。ここで<code class="docutils literal notranslate"><span class="pre">columns</span></code>となるのは列を横断すると覚えれば良いだろう。支出要素だけを合計してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>year
2012    517628.150
2013    528173.900
2014    529751.300
2015    538098.800
2016    541964.975
2017    551427.675
2018    554560.450
2019    553148.175
2020    527637.450
2021    537007.400
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>同じ使い方で次のメソッドが利用できる。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.max()</span></code>：最大値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.min()</span></code>：最小値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.mean()</span></code>：（算術）平均</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.std()</span></code>：標準偏差</p>
<ul>
<li><p>引数<code class="docutils literal notranslate"><span class="pre">ddof=1</span></code>はデフォルトで<code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std()</span></code>はデフォルトで不偏標準偏差を計算する</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.var()</span></code>：分散</p>
<ul>
<li><p>引数<code class="docutils literal notranslate"><span class="pre">ddof=1</span></code>はデフォルトで<code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var()</span></code>はデフォルトで不偏分散を計算する</p></li>
</ul>
</li>
</ul>
<p>次の２つも便利である。計算する際，欠損値は無視され，結果は<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として返される。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.cov()</span></code>：分散共分散行列</p>
<ul>
<li><p>引数<code class="docutils literal notranslate"><span class="pre">ddof=1</span></code>はデフォルトで<code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cov()</span></code>はデフォルトで不偏分散・共分散を計算する</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.corr()</span></code>：相関係数</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code>と<code class="docutils literal notranslate"><span class="pre">numpy</span></code>では，標準偏差，分散，共分散を計算する際の引数<code class="docutils literal notranslate"><span class="pre">ddof</span></code>のデフォルトの値が異なるので注意が必要！</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>のメソッド</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.std()</span></code>，<code class="docutils literal notranslate"><span class="pre">.var()</span></code>，<code class="docutils literal notranslate"><span class="pre">.cov()</span></code>の全てで<code class="docutils literal notranslate"><span class="pre">ddof=1</span></code>がデフォルト</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code>の関数</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.std()</span></code>，<code class="docutils literal notranslate"><span class="pre">.var()</span></code>では<code class="docutils literal notranslate"><span class="pre">ddof=0</span></code>がデフォルト</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cov()</span></code>では<code class="docutils literal notranslate"><span class="pre">ddof=1</span></code>がデフォルト</p></li>
</ul>
</li>
</ul>
<p>母集団の標準偏差・分散・共分散の不偏推定量を計算するには<code class="docutils literal notranslate"><span class="pre">ddof=1</span></code>が必要！！</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>のメソッド<code class="docutils literal notranslate"><span class="pre">.cov()</span></code>と<code class="docutils literal notranslate"><span class="pre">.corr()</span></code>は欠損値を自動的に無視する。従って，相関係数の場合，<code class="docutils literal notranslate"><span class="pre">.corr()</span></code>の結果と<code class="docutils literal notranslate"><span class="pre">.std()</span></code>を使う「手計算」の結果を比べる際は欠損値がどのように扱われているかに注意する必要がある。</p>
</div>
<p>例えば，<code class="docutils literal notranslate"><span class="pre">.cov()</span></code>を計算してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>gov</th>
      <th>net_ex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>gdp</th>
      <td>1.497548e+08</td>
      <td>3.133412e+07</td>
      <td>6.187068e+07</td>
      <td>2.398800e+07</td>
      <td>3.475253e+07</td>
    </tr>
    <tr>
      <th>con</th>
      <td>3.133412e+07</td>
      <td>3.773237e+07</td>
      <td>1.138839e+07</td>
      <td>-2.010831e+07</td>
      <td>2.691150e+06</td>
    </tr>
    <tr>
      <th>inv</th>
      <td>6.187068e+07</td>
      <td>1.138839e+07</td>
      <td>2.814845e+07</td>
      <td>9.745975e+06</td>
      <td>1.342318e+07</td>
    </tr>
    <tr>
      <th>gov</th>
      <td>2.398800e+07</td>
      <td>-2.010831e+07</td>
      <td>9.745975e+06</td>
      <td>2.702392e+07</td>
      <td>7.750688e+06</td>
    </tr>
    <tr>
      <th>net_ex</th>
      <td>3.475253e+07</td>
      <td>2.691150e+06</td>
      <td>1.342318e+07</td>
      <td>7.750688e+06</td>
      <td>1.150046e+07</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>対角成分は分散であり，その他は行と列のラベルに対応する共分散となる。<code class="docutils literal notranslate"><span class="pre">.corr()</span></code>も同じ位置関係となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>gov</th>
      <th>net_ex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>gdp</th>
      <td>1.000000</td>
      <td>0.416841</td>
      <td>0.952944</td>
      <td>0.377076</td>
      <td>0.837411</td>
    </tr>
    <tr>
      <th>con</th>
      <td>0.416841</td>
      <td>1.000000</td>
      <td>0.349444</td>
      <td>-0.629715</td>
      <td>0.129188</td>
    </tr>
    <tr>
      <th>inv</th>
      <td>0.952944</td>
      <td>0.349444</td>
      <td>1.000000</td>
      <td>0.353365</td>
      <td>0.746054</td>
    </tr>
    <tr>
      <th>gov</th>
      <td>0.377076</td>
      <td>-0.629715</td>
      <td>0.353365</td>
      <td>1.000000</td>
      <td>0.439651</td>
    </tr>
    <tr>
      <th>net_ex</th>
      <td>0.837411</td>
      <td>0.129188</td>
      <td>0.746054</td>
      <td>0.439651</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>また変数の変化率（成長率）を計算するには<code class="docutils literal notranslate"><span class="pre">.pct_change()</span></code>が便利である（percent changeの略）。<span class="math notranslate nohighlight">\(x_t\)</span>を変数とすると、次式に従って毎期ごとの変化率を返すことになる。</p>
<div class="math notranslate nohighlight">
\[
\text{変化率}_t=\frac{x_{t}-x_{t-1}}{x_{t-1}}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>con</th>
      <th>inv</th>
      <th>gov</th>
      <th>net_ex</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>0.020454</td>
      <td>0.026559</td>
      <td>0.019333</td>
      <td>0.022402</td>
      <td>0.523895</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>0.002146</td>
      <td>-0.009925</td>
      <td>0.025954</td>
      <td>0.011157</td>
      <td>-0.088195</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>0.015939</td>
      <td>-0.001615</td>
      <td>0.053258</td>
      <td>0.006202</td>
      <td>-0.460373</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>0.007184</td>
      <td>-0.004772</td>
      <td>0.004591</td>
      <td>0.016516</td>
      <td>-0.884777</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>0.017051</td>
      <td>0.010777</td>
      <td>0.025407</td>
      <td>0.002445</td>
      <td>-9.223242</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>0.005703</td>
      <td>0.001993</td>
      <td>0.010548</td>
      <td>0.009266</td>
      <td>0.036173</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>-0.002398</td>
      <td>-0.005187</td>
      <td>0.002982</td>
      <td>0.017935</td>
      <td>-0.902877</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>-0.045339</td>
      <td>-0.052411</td>
      <td>-0.075394</td>
      <td>0.026732</td>
      <td>-17.327952</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>0.016792</td>
      <td>0.013115</td>
      <td>-0.014270</td>
      <td>0.009170</td>
      <td>-1.265629</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">2011</span></code>年が無いため，<code class="docutils literal notranslate"><span class="pre">2012</span></code>年の成長率は欠損値となっている。％表示するのであれば</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">100</span> <span class="o">*</span> <span class="n">jp</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</pre></div>
</div>
<p>とすれば良いだろう。</p>
<p><code class="docutils literal notranslate"><span class="pre">.pct_change()</span></code>と<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>を続けて書くと簡単に（算術）平均成長率を計算することができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jp</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp       0.004170
con      -0.002385
inv       0.005823
gov       0.013536
net_ex   -3.288109
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="id31">
<h3>その他<a class="headerlink" href="#id31" title="Link to this heading">#</a></h3>
<p>列<code class="docutils literal notranslate"><span class="pre">id</span></code>には文字列があり，行のデータをカテゴリー別に分けていると考えることができる。メソッド<code class="docutils literal notranslate"><span class="pre">.unique()</span></code>を使うと，選択した列に重複したデータがある場合，ユニークなものだけを抽出できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Asia&#39;, &#39;Europe&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>まな類似するメソッドに<code class="docutils literal notranslate"><span class="pre">.nunique()</span></code>があり，カテゴリー数を返す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<p>関連するメソッドに<code class="docutils literal notranslate"><span class="pre">.value_counts()</span></code>がある。これを使うとカテゴリーの内訳を確認するすることができる。各カテゴリーに対応する行数（度数）を表示するには</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>continent
Asia      6
Europe    4
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>とする。引数<code class="docutils literal notranslate"><span class="pre">normalize=True</span></code>を追加すると，相対度数として表示できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>continent
Asia      0.6
Europe    0.4
Name: proportion, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>のように行数が少ない<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の場合，これらのメソッドの有用性を見出すことは難しいが，何千行あるデータを扱っていると想像してみよう。そのような大きなデータを扱う場合は非常に重宝するメソッドだろう。</p>
</section>
</section>
<section id="series">
<h2><code class="docutils literal notranslate"><span class="pre">Series</span></code>について<a class="headerlink" href="#series" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>について簡単に説明する。<code class="docutils literal notranslate"><span class="pre">Series</span></code>はスプレッド・シートから１つの行または列を取り出したようなデータとイメージすれば良いだろう。まず<code class="docutils literal notranslate"><span class="pre">df</span></code>の列<code class="docutils literal notranslate"><span class="pre">gdp</span></code>から<code class="docutils literal notranslate"><span class="pre">Series</span></code>を作ってみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
<span class="n">s</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
China        20118.0
France        2950.0
Germany       4274.0
India         9142.0
Italy         2463.0
Japan         5032.0
Korea         2157.0
Singapore      477.0
Taiwan        1100.0
UK            2994.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>もしくは</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>で列を抽出すると<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>が返される。また次のように<code class="docutils literal notranslate"><span class="pre">s</span></code>のメソッド<code class="docutils literal notranslate"><span class="pre">.to_frame()</span></code>を使うと<code class="docutils literal notranslate"><span class="pre">Series</span></code>を<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>に変換できるので、覚えておくと便利かも知れない。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>
</div>
<p>新たに列ラベルを設定する場合は</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;新たな列ラベル&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>とする。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>の行ラベルが整数型であり、それが<code class="docutils literal notranslate"><span class="pre">s</span></code>のインデックスに使われている。
また、<code class="docutils literal notranslate"><span class="pre">gdp</span></code>は<code class="docutils literal notranslate"><span class="pre">s</span></code>の名前（<code class="docutils literal notranslate"><span class="pre">Name</span></code>）として使われている。</p>
<section id="id32">
<h3>構成要素<a class="headerlink" href="#id32" title="Link to this heading">#</a></h3>
<p>この例を使い<code class="docutils literal notranslate"><span class="pre">Series</span></code>の構成要素について説明する。</p>
<ul class="simple">
<li><p>データ：<code class="docutils literal notranslate"><span class="pre">s.to_numpy()</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">s.values</span></code>で抽出可能</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Series</span></code>名：<code class="docutils literal notranslate"><span class="pre">s.name</span></code>で抽出可能</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の列ラベルから引き継がれているが、空の場合もある。</p></li>
</ul>
</li>
<li><p>インデックスもしくはラベル：<code class="docutils literal notranslate"><span class="pre">s.index</span></code>で抽出可能</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の行ラベルから引き継がれている</p></li>
<li><p>インデックス（index）は<code class="docutils literal notranslate"><span class="pre">0</span></code>,<code class="docutils literal notranslate"><span class="pre">1</span></code>,<code class="docutils literal notranslate"><span class="pre">2</span></code>,…の順番で表される。</p></li>
</ul>
</li>
<li><p>インデックス名：<code class="docutils literal notranslate"><span class="pre">s.index.name</span></code>で抽出可能</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code>の行ラベル名から引き継がれていが、空の場合もある。</p></li>
</ul>
</li>
</ul>
<p>まずデータ自体を抽出する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([20118.,  2950.,  4274.,  9142.,  2463.,  5032.,  2157.,   477.,
        1100.,  2994.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>numpy.ndarray
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>名の抽出</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;gdp&#39;
</pre></div>
</div>
</div>
</div>
<p>ラベルの抽出</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;China&#39;, &#39;France&#39;, &#39;Germany&#39;, &#39;India&#39;, &#39;Italy&#39;, &#39;Japan&#39;, &#39;Korea&#39;,
       &#39;Singapore&#39;, &#39;Taiwan&#39;, &#39;UK&#39;],
      dtype=&#39;object&#39;, name=&#39;country&#39;)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dtype='object'</span></code>とあるが、ラベルは文字列であることがわかる。</p>
</section>
<section id="id33">
<h3>要素の抽出<a class="headerlink" href="#id33" title="Link to this heading">#</a></h3>
<p>要素の抽出はラベルを使う方法とインデックスを使う方法がある。ラベルを使う場合を考えてみよう。<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>と同様に<code class="docutils literal notranslate"><span class="pre">.loc[]</span></code>を使う事ができる。違いは、<code class="docutils literal notranslate"><span class="pre">Series</span></code>の場合、行と列の区別がないのでラベルだけを指定すれば良い。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Japan&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5032.0
</pre></div>
</div>
</div>
</div>
<p>複数の場合はラベルをリストとする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;Japan&#39;</span><span class="p">,</span><span class="s1">&#39;Korea&#39;</span><span class="p">,</span><span class="s1">&#39;UK&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
Japan    5032.0
Korea    2157.0
UK       2994.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>ラベルを使う場合，<code class="docutils literal notranslate"><span class="pre">.loc</span></code>を省略することができる。辞書と同じような形となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;Japan&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5032.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="p">[[</span><span class="s1">&#39;Japan&#39;</span><span class="p">,</span><span class="s1">&#39;Korea&#39;</span><span class="p">,</span><span class="s1">&#39;UK&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
Japan    5032.0
Korea    2157.0
UK       2994.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>次にインデックスを使う要素の抽出方法を紹介しよう。<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>と同様に<code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>を使う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5032.0
</pre></div>
</div>
</div>
</div>
<p>複数のインデックスを使うことも可能である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
France    2950.0
India     9142.0
Japan     5032.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>またスライシングも同様にできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>country
Japan        5032.0
Korea        2157.0
Singapore     477.0
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Pandasのバージョンによっては<code class="docutils literal notranslate"><span class="pre">.iloc</span></code>を省略して<code class="docutils literal notranslate"><span class="pre">s[1]</span></code>のようにして要素にアクセスできるかも知れないが、バージョンが進むと使えなくなるので注意しよう。</p>
</div>
</section>
<section id="id34">
<h3>統計学関連メソッド<a class="headerlink" href="#id34" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code>にも<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>と同じような統計学関連メソッドが実装されているので，<code class="docutils literal notranslate"><span class="pre">py4macro.see()</span></code>で調べてみよう。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">py4macro</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>.China              .France             .Germany            .India
.Italy              .Japan              .Korea              .Singapore
.T                  .Taiwan             .UK                 .abs
.add                .add_prefix         .add_suffix         .agg
.aggregate          .align              .all                .any
.apply              .argmax             .argmin             .argsort
.array              .asfreq             .asof               .astype
.at                 .at_time            .attrs              .autocorr
.axes               .backfill           .between            .between_time
.bfill              .bool               .case_when          .clip
.combine            .combine_first      .compare            .convert_dtypes
.copy               .corr               .count              .cov
.cummax             .cummin             .cumprod            .cumsum
.describe           .diff               .div                .divide
.divmod             .dot                .drop               .drop_duplicates
.droplevel          .dropna             .dtype              .dtypes
.duplicated         .empty              .eq                 .equals
.ewm                .expanding          .explode            .factorize
.ffill              .fillna             .filter             .first
.first_valid_index  .flags              .floordiv           .ge
.get                .groupby            .gt                 .hasnans
.head               .hist               .iat                .idxmax
.idxmin             .iloc               .index              .infer_objects
.info               .interpolate        .is_monotonic_decreasing  .is_monotonic_increasing
.is_unique          .isin               .isna               .isnull
.item               .items              .keys               .kurt
.kurtosis           .last               .last_valid_index   .le
.list               .loc                .lt                 .map
.mask               .max                .mean               .median
.memory_usage       .min                .mod                .mode
.mul                .multiply           .name               .nbytes
.ndim               .ne                 .nlargest           .notna
.notnull            .nsmallest          .nunique            .pad
.pct_change         .pipe               .plot               .pop
.pow                .prod               .product            .quantile
.radd               .rank               .ravel              .rdiv
.rdivmod            .reindex            .reindex_like       .rename
.rename_axis        .reorder_levels     .repeat             .replace
.resample           .reset_index        .rfloordiv          .rmod
.rmul               .rolling            .round              .rpow
.rsub               .rtruediv           .sample             .searchsorted
.sem                .set_axis           .set_flags          .shape
.shift              .size               .skew               .sort_index
.sort_values        .squeeze            .std                .struct
.sub                .subtract           .sum                .swapaxes
.swaplevel          .tail               .take               .to_clipboard
.to_csv             .to_dict            .to_excel           .to_frame
.to_hdf             .to_json            .to_latex           .to_list
.to_markdown        .to_numpy           .to_period          .to_pickle
.to_sql             .to_string          .to_timestamp       .to_xarray
.transform          .transpose          .truediv            .truncate
.tz_convert         .tz_localize        .unique             .unstack
.update             .value_counts       .values             .var
.view               .where              .xs
</pre></div>
</div>
</div>
</div>
<p>この中に</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.mean</span></code>：平均</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.std</span></code>：標準偏差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.var</span></code>：分散</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.sum</span></code>：合計</p></li>
</ul>
<p>を計算するメソッドが含まれているのが確認できる。</p>
</section>
</section>
<section id="id35">
<h2>グループ計算<a class="headerlink" href="#id35" title="Link to this heading">#</a></h2>
<p>上で使った<code class="docutils literal notranslate"><span class="pre">df</span></code>を表示してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
      <th>con</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>China</th>
      <td>20118.0</td>
      <td>7796.0</td>
      <td>9137.0</td>
      <td>1434.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>France</th>
      <td>2950.0</td>
      <td>1598.0</td>
      <td>806.0</td>
      <td>67.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>Germany</th>
      <td>4274.0</td>
      <td>2294.0</td>
      <td>971.0</td>
      <td>84.0</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>India</th>
      <td>9142.0</td>
      <td>5936.0</td>
      <td>2471.0</td>
      <td>1366.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>Italy</th>
      <td>2463.0</td>
      <td>1423.0</td>
      <td>614.0</td>
      <td>61.0</td>
      <td>Europe</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>のメソッド<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>を使うと列の平均を簡単に計算できることは説明した。<code class="docutils literal notranslate"><span class="pre">id</span></code>以外の列を取り出して計算してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>gdp    5070.700000
inv    2605.222222
con    2009.625000
pop     328.800000
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>一方で，列<code class="docutils literal notranslate"><span class="pre">continent</span></code>には<code class="docutils literal notranslate"><span class="pre">Asia</span></code>と<code class="docutils literal notranslate"><span class="pre">Europe</span></code>があり，<code class="docutils literal notranslate"><span class="pre">df</span></code>を２つのグループに分けることができる。ここで問題になるのは，グループ別に列の平均を計算したい場合である。まず考えられる方法は<code class="docutils literal notranslate"><span class="pre">Asia</span></code>グループだけを抽出して平均を計算し，同じように<code class="docutils literal notranslate"><span class="pre">Europe</span></code>も計算するということだろう。もしグループ数が多い場合は<code class="docutils literal notranslate"><span class="pre">for</span></code>ループが必要になり，より長いコードを書く必要があり面倒に感じることになる。</p>
<p>こういう場合のために，<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>には簡単にグループ計算を可能にする方法が用意されている。それが<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>というメソッドである。以下では<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>の使い方を<code class="docutils literal notranslate"><span class="pre">df</span></code>を使って３つのステップに分けて説明する。</p>
<section id="id36">
<h3>ステップ１：グループ化する列を指定<a class="headerlink" href="#id36" title="Link to this heading">#</a></h3>
<p>最初のステップでは，<strong>グループ化したい列名</strong>を引数として<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>を実行する。<code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">continent</span></code>でグループ化したいので次のコードとなる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>＜注意＞</strong><br>
このコードは<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>を返すわけでは<strong>ない</strong>。返すのはグループ計算用のオブジェクトであり，それを使ってグループ計算をおこなう事になる。</p>
<p>実際にコードを実行し，変数<code class="docutils literal notranslate"><span class="pre">df_groupby</span></code>に割り当てよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df_groupby</span></code>を実行してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x1180642f0&gt;
</pre></div>
</div>
</div>
</div>
<p>何も返されない。表示されているのは，PCメモリーのある箇所に<code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code>というオブジェクトが存在すると伝えているだけである。</p>
</section>
<section id="id37">
<h3>ステップ２：グループ計算したい列を指定<a class="headerlink" href="#id37" title="Link to this heading">#</a></h3>
<p>次にグループ計算したい列を指定するが，次の様な書き方となる。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>df_groupby[＜グループ計算したい列ラベル＞]
</pre></div>
</div>
<p>ここで<code class="docutils literal notranslate"><span class="pre">[]</span></code>を使っていることに注意しよう。例として<code class="docutils literal notranslate"><span class="pre">gdp</span></code>をグループ計算するとしよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.SeriesGroupBy object at 0x1180315e0&gt;
</pre></div>
</div>
</div>
</div>
<p>ここでも新たなオブジェクト<code class="docutils literal notranslate"><span class="pre">SeriesGroupBy</span></code>のメモリーアドレスが表示されるだけである。どの様に計算するかを指定することにより，計算結果が返されることになる。それが次のステップである。</p>
</section>
<section id="id38">
<h3>ステップ３：計算方法の指定<a class="headerlink" href="#id38" title="Link to this heading">#</a></h3>
<p>ステップ１と２がグループ計算の準備段階であり，あとは実際にどのように計算したいかを指定する。例として，平均を考えてみよう。上でも出てきたが，平均はメソッド<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>を使う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>continent
Asia      6337.666667
Europe    3170.250000
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>グループ計算結果は<code class="docutils literal notranslate"><span class="pre">Series</span></code>として返されている。<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>以外にも使える関数は準備されいる。<code class="docutils literal notranslate"><span class="pre">py4macro.see()</span></code>を使って属性・メソッドを調べてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">py4macro</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>.China              .France             .Germany            .India
.Italy              .Japan              .Korea              .Singapore
.Taiwan             .UK                 .agg                .aggregate
.all                .any                .apply              .bfill
.corr               .count              .cov                .cumcount
.cummax             .cummin             .cumprod            .cumsum
.describe           .diff               .dtype              .ewm
.expanding          .ffill              .fillna             .filter
.first              .get_group          .groups             .head
.hist               .idxmax             .idxmin             .indices
.is_monotonic_decreasing  .is_monotonic_increasing  .last               .max
.mean               .median             .min                .ndim
.ngroup             .ngroups            .nlargest           .nsmallest
.nth                .nunique            .ohlc               .pct_change
.pipe               .plot               .prod               .quantile
.rank               .resample           .rolling            .sample
.sem                .shift              .size               .skew
.std                .sum                .tail               .take
.transform          .unique             .value_counts       .var
</pre></div>
</div>
</div>
</div>
<p>主なメソッドとして次を挙げることができる（これらの計算で欠損値は無視される）。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mean()</span></code>：平均</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">median()</span></code>：中央値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max()</span></code>：最大値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min()</span></code>：最小値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std()</span></code>：標準偏差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var()</span></code>：分散</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code>：合計</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cumsum()</span></code>：累積和</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">first()</span></code>：最初の値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last()</span></code>：最後の値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">count()</span></code>：要素数</p></li>
<li><p>などなど</p></li>
</ul>
<p>このリストにない計算をしたい場合もあるだろう。その場合は，上のリストにもある<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>（<code class="docutils literal notranslate"><span class="pre">aggregate()</span></code>も同じ）を使い，自作の関数を指定することができる。例えば，平均を計算する自作の関数<code class="docutils literal notranslate"><span class="pre">my_mean()</span></code>を考えてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>ここでの<code class="docutils literal notranslate"><span class="pre">x</span></code>はステップ２で指定する計算する対象の列と考えれば良いだろう。実際に実行してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_groupby</span><span class="p">[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">my_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>continent
Asia      6337.666667
Europe    3170.250000
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>この場合，<code class="docutils literal notranslate"><span class="pre">()</span></code>がなく，関数名だけを<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>の引数にしている。関数名だけを<code class="docutils literal notranslate"><span class="pre">.agg</span></code>に渡し，<code class="docutils literal notranslate"><span class="pre">.agg</span></code>が渡された関数を実行するというイメージである。<code class="docutils literal notranslate"><span class="pre">()</span></code>を付けると<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>に渡す前に関数を実行することになりエラーとなってしまう。</p>
</div>
</section>
<section id="id39">
<h3>次のステップ<a class="headerlink" href="#id39" title="Link to this heading">#</a></h3>
<section id="id40">
<h4>１行で書く<a class="headerlink" href="#id40" title="Link to this heading">#</a></h4>
<p>上の説明では３つのステップに分けたが，もちろん次のように３つのステップを次のように１行で書いても構わないし，むしろその場合が多いだろう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)[</span><span class="s1">&#39;gdp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>continent
Asia      6337.666667
Europe    3170.250000
Name: gdp, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>このコードは次の様に読むことができる。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">id</span></code>でグループ分けして，<code class="docutils literal notranslate"><span class="pre">gdp</span></code>の平均を計算する。</p>
</div></blockquote>
</section>
<section id="id41">
<h4>複数選択<a class="headerlink" href="#id41" title="Link to this heading">#</a></h4>
<p>各ステップでは列や関数を一つだけ選択・設定しているが，それぞれ複数選択することも可能である。</p>
<ul class="simple">
<li><p>ステップ１ではグループ化する上で基準となる列を複数選択</p></li>
<li><p>ステップ２では計算対象となる列を複数選択</p></li>
<li><p>ステップ３では<code class="docutils literal notranslate"><span class="pre">.agg()</span></code>の引数に複数の関数を指定</p></li>
</ul>
<p>という具合である。ただその場合は，リストとして列や関数名を指定する必要がある。例えば，ステップ２で<code class="docutils literal notranslate"><span class="pre">gdp</span></code>と<code class="docutils literal notranslate"><span class="pre">inv</span></code>を選ぶとしよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)[[</span><span class="s1">&#39;gdp&#39;</span><span class="p">,</span><span class="s1">&#39;inv&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gdp</th>
      <th>inv</th>
    </tr>
    <tr>
      <th>continent</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Asia</th>
      <td>6337.666667</td>
      <td>3022.000000</td>
    </tr>
    <tr>
      <th>Europe</th>
      <td>3170.250000</td>
      <td>1771.666667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>結果は<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>として返されている。ステップ１もしくは３で複数選択すると<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>が<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>（階層的な行と列）として返されることになるが，その簡単な説明については<a class="reference external" href="https://py4basics.github.io/Gapminder.html">Gapminder</a>を参照して欲しい。より詳しい説明は他のサイトに譲ることにする。</p>
<p><code class="docutils literal notranslate"><span class="pre">df</span></code>のような小さな<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>では<code class="docutils literal notranslate"><span class="pre">.groupby</span></code>の威力はあまりピンとこないかも知れない。しかし大きな<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>を使うとその恩恵を強く感じることだろう。<a class="reference external" href="https://py4basics.github.io/Gapminder.html">Gapminder</a>ではマクロ経済データを使い<code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>の使い方の例を示している。興味がある人は是非！</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="2_NumPy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">NumPy</span></code>：高速化</p>
      </div>
    </a>
    <a class="right-next"
       href="4_matplotlib.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">Matplotlib</span></code>：図示</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">説明</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sec-3-data">データの読み込みとデータのチェック</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe"><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>の構成要素</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">要素の抽出</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">説明</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loc"><code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code>（ラベル使用）</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iloc"><code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>（インデックス使用）</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><code class="docutils literal notranslate"><span class="pre">[]</span></code>で列の選択（ラベル使用）</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">ある条件の下で行の抽出</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">１つの条件の場合</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gdp1200">例１：GDPが1200未満の行の抽出</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#continentasia">例２：<code class="docutils literal notranslate"><span class="pre">continent</span></code>が<code class="docutils literal notranslate"><span class="pre">Asia</span></code>の行を抽出</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">複数条件の場合</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">例３</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">例４</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">例５</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#query"><code class="docutils literal notranslate"><span class="pre">query()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">例１の場合：</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">例２の場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">例３の場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">例４の場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">例５の場合</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">列と行の追加と削除</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">列の追加 <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">列の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#del">列の削除 <code class="docutils literal notranslate"><span class="pre">del</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drop">列の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">行の追加 <code class="docutils literal notranslate"><span class="pre">.loc[,]</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">行の削除 <code class="docutils literal notranslate"><span class="pre">drop()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">欠損値の扱い</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">欠損値の確認</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">欠損値がある行の削除</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">並び替え</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">行番号と列ラベル</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">行番号を振り直す</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">列のラベルの変更</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">よく使うメソッド</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">統計関連のメソッド</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">その他</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series"><code class="docutils literal notranslate"><span class="pre">Series</span></code>について</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">構成要素</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">要素の抽出</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">統計学関連メソッド</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">グループ計算</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">ステップ１：グループ化する列を指定</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">ステップ２：グループ計算したい列を指定</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">ステップ３：計算方法の指定</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">次のステップ</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">１行で書く</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">複数選択</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By 春山 鉄源  Tetsugen HARUYAMA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <!-- Default Statcounter code for Py4Basics https://py4basics.github.io --> <script type="text/javascript"> var sc_project=12615270; var sc_invisible=1; var sc_security="2a7796f0"; </script> <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script> <noscript><div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img class="statcounter" src="https://c.statcounter.com/12615270/0/2a7796f0/1/" alt="Web Analytics" referrerPolicy="no-referrer-when-downgrade"></a></div></noscript> <!-- End of Statcounter Code -->
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>